<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Classification data: How to make 14 individual classification models | Ensembles: From Beginner to Expert</title>
<meta name="author" content="Russ Conte">
<meta name="description" content="Ensembles of numerical data give results that are often superior to any individual model. We’ve seen results where ensembles of numerical data beat nearly all of the individual models, as measures...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Chapter 5 Classification data: How to make 14 individual classification models | Ensembles: From Beginner to Expert">
<meta property="og:type" content="book">
<meta property="og:description" content="Ensembles of numerical data give results that are often superior to any individual model. We’ve seen results where ensembles of numerical data beat nearly all of the individual models, as measures...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Classification data: How to make 14 individual classification models | Ensembles: From Beginner to Expert">
<meta name="twitter:description" content="Ensembles of numerical data give results that are often superior to any individual model. We’ve seen results where ensembles of numerical data beat nearly all of the individual models, as measures...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Ensembles: From Beginner to Expert</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome!</a></li>
<li><a class="" href="introduction-and-your-first-ensembles.html"><span class="header-section-number">2</span> Introduction and your first ensembles</a></li>
<li><a class="" href="numerical-data-how-to-make-23-individual-models-and-basic-skills-with-functions.html"><span class="header-section-number">3</span> Numerical data: How to make 23 individual models, and basic skills with functions</a></li>
<li><a class="" href="building-weighted-ensembles-to-model-numerical-data.html"><span class="header-section-number">4</span> Building weighted ensembles to model numerical data</a></li>
<li><a class="active" href="classification-data-how-to-make-14-individual-classification-models.html"><span class="header-section-number">5</span> Classification data: How to make 14 individual classification models</a></li>
<li><a class="" href="building-ensembles-of-classification-models.html"><span class="header-section-number">6</span> Building ensembles of classification models</a></li>
<li><a class="" href="individual-logistic-models.html"><span class="header-section-number">7</span> Individual logistic models</a></li>
<li><a class="" href="advice-to-lebron-james-and-everyone-who-does-talent-analytics-logistic-ensembles.html"><span class="header-section-number">8</span> Advice to Lebron James (and everyone who does talent analytics): Logistic ensembles</a></li>
<li><a class="" href="how-to-make-27-individual-forecasting-models.html"><span class="header-section-number">9</span> How to Make 27 Individual Forecasting Models</a></li>
<li><a class="" href="ensembles-of-26-forecasting-models.html"><span class="header-section-number">10</span> Ensembles of 26 Forecasting Models</a></li>
<li><a class="" href="predicting-on-totally-new-data-with-individual-models-and-ensembles.html"><span class="header-section-number">11</span> Predicting on totally new data with individual models and ensembles</a></li>
<li><a class="" href="how-to-communicate-your-results.html"><span class="header-section-number">12</span> How to communicate your results</a></li>
<li><a class="" href="final-comprhensive-project.html"><span class="header-section-number">13</span> Final Comprhensive Project</a></li>
<li><a class="" href="summary-and-charge-to-the-graduates-of-the-class.html"><span class="header-section-number">14</span> Summary and Charge to the Graduates of the Class!</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/InfinteCuriosity/EnsemblesBook">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="classification-data-how-to-make-14-individual-classification-models" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Classification data: How to make 14 individual classification models<a class="anchor" aria-label="anchor" href="#classification-data-how-to-make-14-individual-classification-models"><i class="fas fa-link"></i></a>
</h1>
<p>Ensembles of numerical data give results that are often superior to any individual model. We’ve seen results where ensembles of numerical data beat nearly all of the individual models, as measures by the lowest error rate.</p>
<p>Now we are going to do the same with classification data. We will build 15 individual models of classification data in this chapter.</p>
<p>The basic series of steps is the same as with numerical data. We will follow the same steps, but we will complete the process with models for classification data.</p>
<blockquote>
<p>Load the library</p>
<p>Set initial values to 0</p>
<p>Create the function</p>
<p>Break the data into train and test sets</p>
<p>Set up random resampling</p>
<p>Fit the model on the training data, make predictions and measure error on the test data</p>
<p>Return the results</p>
<p>Check for errors or warnings</p>
<p>Test on a different data set</p>
</blockquote>
<p>All our models will be structured in a way that is as close to identical as possible. A very high level of consistency makes it easier to spot errors.</p>
<div id="what-is-classification-data" class="section level3" number="5.0.1">
<h3>
<span class="header-section-number">5.0.1</span> What is classification data?<a class="anchor" aria-label="anchor" href="#what-is-classification-data"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://en.wikipedia.org/wiki/Statistical_classification">Classification models</a> are a set of models to identify the class of a specific observation. For example, in the Carseats data set, the Shelve Location is an example of this data type:</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.statlearning.com">ISLR</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Carseats</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Sales CompPrice Income Advertising Population Price</span></span>
<span><span class="co">#&gt; 1  9.50       138     73          11        276   120</span></span>
<span><span class="co">#&gt; 2 11.22       111     48          16        260    83</span></span>
<span><span class="co">#&gt; 3 10.06       113     35          10        269    80</span></span>
<span><span class="co">#&gt; 4  7.40       117    100           4        466    97</span></span>
<span><span class="co">#&gt; 5  4.15       141     64           3        340   128</span></span>
<span><span class="co">#&gt; 6 10.81       124    113          13        501    72</span></span>
<span><span class="co">#&gt;   ShelveLoc Age Education Urban  US</span></span>
<span><span class="co">#&gt; 1       Bad  42        17   Yes Yes</span></span>
<span><span class="co">#&gt; 2      Good  65        10   Yes Yes</span></span>
<span><span class="co">#&gt; 3    Medium  59        12   Yes Yes</span></span>
<span><span class="co">#&gt; 4    Medium  55        14   Yes Yes</span></span>
<span><span class="co">#&gt; 5       Bad  38        13   Yes  No</span></span>
<span><span class="co">#&gt; 6       Bad  78        16    No Yes</span></span></code></pre></div>
<p>When we look at the ShelveLoc column, it is not a set of numbers, but one of three locations on the shelf: Bad, Medium or Good. Classification models are statistical models to predict the class of the data.</p>
<p>Classification models are very similar to numerical models. We will follow the same basic steps as the numerical models, but use classification models instead.</p>
<p>One big difference is how accuracy is measured in classification data. For numerical models we used root mean squared error. Our measure for classification will simply be the accuracy of the result. This can be measured directly from a matrix of values. For example:</p>
<p>C50 test results:</p>
<div class="float">
<img src="Images/C50_table.png" alt="C50 table example"><div class="figcaption">C50 table example</div>
</div>
<p>The accuracy is determined by calculating the number of correct responses divided by the total number of responses. The correct responses are along the main diagonal.</p>
<p>For example, the model was correct when it predicted 83 bad responses, however it also predicted the response was bad when it was actually Good, and it also predicted Bad when it was actually Medium. The correct responses are down the main diagonal, the other responses are errors. We will use these in our calculation of accuracy of the model results.</p>
<p>In this case, that is (83 + 75 + 272) / (83 + 1 + 105 + 4 + 75 + 56 + 106 + 90 + 272) = 0.5429293. We will create a function to calculate this result automatically for each classification model. Clearly the higher the accuracy, the better the results. The best possible accuracy result is 1.00.</p>
</div>
<div id="build-our-first-classification-model-from-the-structure" class="section level3" number="5.0.2">
<h3>
<span class="header-section-number">5.0.2</span> Build our first classification model from the structure:<a class="anchor" aria-label="anchor" href="#build-our-first-classification-model-from-the-structure"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span></span>
<span><span class="co"># Set up resamples</span></span>
<span></span>
<span><span class="co"># Randomize the rows</span></span>
<span></span>
<span><span class="co"># Split data into train and test sets</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="co"># Print table results</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span></span>
<span><span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span></span>
<span><span class="co"># Check for errors</span></span></code></pre></div>
<p>Now that we have the structure, let’s build the model:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://topepo.github.io/C5.0/">C50</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching core tidyverse packages ──── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.5</span></span>
<span><span class="co">#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.1</span></span>
<span><span class="co">#&gt; ✔ ggplot2   3.5.1     ✔ tibble    3.2.1</span></span>
<span><span class="co">#&gt; ✔ lubridate 1.9.3     ✔ tidyr     1.3.1</span></span>
<span><span class="co">#&gt; ✔ purrr     1.0.2     </span></span>
<span><span class="co">#&gt; ── Conflicts ────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span><span class="co">#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Set initial values to 0:</span></span>
<span><span class="va">C50_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">C50_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">C50_validation_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">C50_overfitting</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">C50_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">C50_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function:</span></span>
<span><span class="va">C50_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Changes target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">C50_train_fit</span> <span class="op">&lt;-</span> <span class="fu">C50</span><span class="fu">::</span><span class="fu"><a href="https://topepo.github.io/C5.0/reference/C5.0.html">C5.0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">y_train</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">C50_train_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">C50_train_fit</span>, <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">C50_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">C50_train_pred</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">C50_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">C50_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">C50_train_table</span><span class="op">)</span></span>
<span><span class="va">C50_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">C50_train_accuracy</span><span class="op">)</span></span>
<span><span class="va">C50_train_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">C50_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">C50_train_table</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">C50_test_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">C50_train_fit</span>, <span class="va">test</span><span class="op">)</span></span>
<span><span class="va">C50_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">C50_test_pred</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">C50_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">C50_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">C50_test_table</span><span class="op">)</span></span>
<span><span class="va">C50_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">C50_test_accuracy</span><span class="op">)</span></span>
<span><span class="va">C50_test_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">C50_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">C50_test_table</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate accuracy</span></span>
<span><span class="va">C50_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">C50_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">C50_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">C50_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">C50_table</span> <span class="op">&lt;-</span> <span class="va">C50_test_table</span></span>
<span><span class="va">C50_table_total</span> <span class="op">&lt;-</span> <span class="va">C50_table_total</span> <span class="op">+</span> <span class="va">C50_table</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">C50_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy result</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">C50_holdout_mean</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="fu">C50_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;              y_test</span></span>
<span><span class="co">#&gt; C50_test_pred Bad Good Medium</span></span>
<span><span class="co">#&gt;        Bad      8    0     10</span></span>
<span><span class="co">#&gt;        Good     0   14      6</span></span>
<span><span class="co">#&gt;        Medium  22    7     41</span></span>
<span><span class="co">#&gt; [1] 0.5833333</span></span></code></pre></div>
<p>Now that we see how one individual classification model is made, let’s make 11 more (total of 12).</p>
</div>
<div id="adabag-for-classification-data" class="section level3" number="5.0.3">
<h3>
<span class="header-section-number">5.0.3</span> Adabag for classification data<a class="anchor" aria-label="anchor" href="#adabag-for-classification-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ipred</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">adabag_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">adabag_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">adabag_validation_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">adabag_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">adabag_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function</span></span>
<span><span class="va">adabag_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">adabag_train_fit</span> <span class="op">&lt;-</span> <span class="fu">ipred</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ipred/man/bagging.html">bagging</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train01</span><span class="op">)</span></span>
<span><span class="va">adabag_train_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">adabag_train_fit</span>, newdata <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">adabag_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">adabag_train_pred</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">adabag_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">adabag_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">adabag_train_table</span><span class="op">)</span></span>
<span><span class="va">adabag_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">adabag_train_accuracy</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">adabag_test_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">adabag_train_fit</span>, newdata <span class="op">=</span> <span class="va">test01</span><span class="op">)</span></span>
<span><span class="va">adabag_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">adabag_test_pred</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">adabag_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">adabag_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">adabag_test_table</span><span class="op">)</span></span>
<span><span class="va">adabag_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">adabag_test_accuracy</span><span class="op">)</span></span>
<span><span class="va">adabag_test_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">adabag_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">adabag_test_table</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate accuracy</span></span>
<span><span class="va">adabag_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">adabag_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">adabag_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">adabag_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">adabag_table</span> <span class="op">&lt;-</span> <span class="va">adabag_test_table</span></span>
<span><span class="va">adabag_table_total</span> <span class="op">&lt;-</span> <span class="va">adabag_table_total</span> <span class="op">+</span> <span class="va">adabag_table</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">adabag_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">adabag_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">adabag_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 y_test</span></span>
<span><span class="co">#&gt; adabag_test_pred Bad Good Medium</span></span>
<span><span class="co">#&gt;           Bad     11    0      7</span></span>
<span><span class="co">#&gt;           Good     0   13      2</span></span>
<span><span class="co">#&gt;           Medium  15    8     44</span></span>
<span><span class="co">#&gt; [1] 0.68</span></span></code></pre></div>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="bagged-random-forest-1" class="section level3" number="5.0.4">
<h3>
<span class="header-section-number">5.0.4</span> Bagged Random Forest<a class="anchor" aria-label="anchor" href="#bagged-random-forest-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/">randomForest</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; randomForest 4.7-1.1</span></span>
<span><span class="co">#&gt; Type rfNews() to see new features/changes/bug fixes.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'randomForest'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     combine</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:ggplot2':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     margin</span></span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">bag_rf_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">bag_rf_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">bag_rf_validation_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">bag_rf_overfitting</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">bag_rf_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">bag_rf_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">bag_rf_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">bag_rf_train_fit</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train01</span>, mtry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">train</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bag_rf_train_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bag_rf_train_fit</span>, <span class="va">train</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">bag_rf_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">bag_rf_train_pred</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">bag_rf_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">bag_rf_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">bag_rf_train_table</span><span class="op">)</span></span>
<span><span class="va">bag_rf_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bag_rf_train_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">bag_rf_test_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bag_rf_train_fit</span>, <span class="va">test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">bag_rf_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">bag_rf_test_pred</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">bag_rf_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">bag_rf_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">bag_rf_test_table</span><span class="op">)</span></span>
<span><span class="va">bag_rf_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bag_rf_test_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate model accuracy</span></span>
<span><span class="va">bag_rf_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bag_rf_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bag_rf_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bag_rf_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">bag_rf_table</span> <span class="op">&lt;-</span> <span class="va">bag_rf_test_table</span></span>
<span><span class="va">bag_rf_table_total</span> <span class="op">&lt;-</span> <span class="va">bag_rf_table_total</span> <span class="op">+</span> <span class="va">bag_rf_table</span></span>
<span></span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">bag_rf_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">bag_rf_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span><span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span><span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">bag_rf_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 y_test</span></span>
<span><span class="co">#&gt; bag_rf_test_pred Bad Good Medium</span></span>
<span><span class="co">#&gt;           Bad      9    1      6</span></span>
<span><span class="co">#&gt;           Good     0   10      6</span></span>
<span><span class="co">#&gt;           Medium  12    6     36</span></span>
<span><span class="co">#&gt; [1] 0.6395349</span></span></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="linear-model" class="section level3" number="5.0.5">
<h3>
<span class="header-section-number">5.0.5</span> Linear model<a class="anchor" aria-label="anchor" href="#linear-model"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://brian-j-smith.github.io/MachineShop/">MachineShop</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'MachineShop'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:purrr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     lift</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     ppr</span></span></code></pre></div>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">linear_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">linear_validation_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">linear_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">linear_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">linear_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">linear_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">linear1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">linear_train_fit</span> <span class="op">&lt;-</span> <span class="fu">MachineShop</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MachineShop/man/fit-methods.html">fit</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train01</span>, model <span class="op">=</span> <span class="st">"LMModel"</span><span class="op">)</span></span>
<span><span class="va">linear_train_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">linear_train_fit</span>, newdata <span class="op">=</span> <span class="va">train01</span><span class="op">)</span></span>
<span><span class="va">linear_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linear_train_pred</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">linear_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">linear_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">linear_train_table</span><span class="op">)</span></span>
<span><span class="va">linear_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">linear_train_accuracy</span><span class="op">)</span></span>
<span><span class="va">linear_train_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">linear_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">linear_train_table</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">linear_test_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">linear_train_fit</span>, newdata <span class="op">=</span> <span class="va">test01</span><span class="op">)</span></span>
<span><span class="va">linear_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">linear_test_pred</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">linear_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">linear_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">linear_test_table</span><span class="op">)</span></span>
<span><span class="va">linear_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">linear_test_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span><span class="va">linear_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">linear_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">linear_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">linear_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">linear_table</span> <span class="op">&lt;-</span> <span class="va">linear_test_table</span></span>
<span><span class="va">linear_table_total</span> <span class="op">&lt;-</span> <span class="va">linear_table_total</span> <span class="op">+</span> <span class="va">linear_table</span></span>
<span></span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">linear_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">linear_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span><span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span><span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">linear1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 y_test</span></span>
<span><span class="co">#&gt; linear_test_pred Bad Good Medium</span></span>
<span><span class="co">#&gt;           Bad      9    0      0</span></span>
<span><span class="co">#&gt;           Good     0    9      1</span></span>
<span><span class="co">#&gt;           Medium  11    5     51</span></span>
<span><span class="co">#&gt; [1] 0.8023256</span></span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="naive-bayes-model" class="section level3" number="5.0.6">
<h3>
<span class="header-section-number">5.0.6</span> Naive Bayes model<a class="anchor" aria-label="anchor" href="#naive-bayes-model"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">e1071</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">n_bayes_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">n_bayes_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">n_bayes_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">n_bayes_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">n_bayes_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">n_bayes_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">n_bayes_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">n_bayes_train_fit</span> <span class="op">&lt;-</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/naiveBayes.html">naiveBayes</a></span><span class="op">(</span><span class="va">y_train</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">n_bayes_train_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">n_bayes_train_fit</span>, <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">n_bayes_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">n_bayes_train_pred</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">n_bayes_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">n_bayes_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n_bayes_train_table</span><span class="op">)</span></span>
<span><span class="va">n_bayes_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">n_bayes_train_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">n_bayes_test_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">n_bayes_train_fit</span>, <span class="va">test</span><span class="op">)</span></span>
<span><span class="va">n_bayes_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">n_bayes_test_pred</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">n_bayes_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">n_bayes_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n_bayes_test_table</span><span class="op">)</span></span>
<span><span class="va">n_bayes_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">n_bayes_test_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span><span class="va">n_bayes_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">n_bayes_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">n_bayes_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">n_bayes_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">n_bayes_table</span> <span class="op">&lt;-</span> <span class="va">n_bayes_test_table</span></span>
<span><span class="va">n_bayes_table_total</span> <span class="op">&lt;-</span> <span class="va">n_bayes_table_total</span> <span class="op">+</span> <span class="va">n_bayes_table</span></span>
<span></span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">n_bayes_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">n_bayes_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">n_bayes_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;                  y_test</span></span>
<span><span class="co">#&gt; n_bayes_test_pred Bad Good Medium</span></span>
<span><span class="co">#&gt;            Bad      8    1      6</span></span>
<span><span class="co">#&gt;            Good     1    9      8</span></span>
<span><span class="co">#&gt;            Medium  15   11     45</span></span>
<span><span class="co">#&gt; [1] 0.5961538</span></span></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="partial-least-squares-1" class="section level3" number="5.0.7">
<h3>
<span class="header-section-number">5.0.7</span> Partial Least Squares<a class="anchor" aria-label="anchor" href="#partial-least-squares-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://brian-j-smith.github.io/MachineShop/">MachineShop</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">pls_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pls_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pls_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pls_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pls_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pls_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">pls_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">pls_train_fit</span> <span class="op">&lt;-</span> <span class="fu">MachineShop</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MachineShop/man/fit-methods.html">fit</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train01</span>, model <span class="op">=</span> <span class="st">"PLSModel"</span><span class="op">)</span></span>
<span><span class="va">pls_train_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pls_train_fit</span>, newdata <span class="op">=</span> <span class="va">train01</span><span class="op">)</span></span>
<span><span class="va">pls_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">pls_train_predict</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">pls_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">pls_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pls_train_table</span><span class="op">)</span></span>
<span><span class="va">pls_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pls_train_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">pls_test_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pls_train_fit</span>, newdata <span class="op">=</span> <span class="va">test01</span><span class="op">)</span></span>
<span><span class="va">pls_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">pls_test_predict</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">pls_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">pls_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pls_test_table</span><span class="op">)</span></span>
<span><span class="va">pls_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pls_test_accuracy</span><span class="op">)</span></span>
<span><span class="va">pls_test_pred</span> <span class="op">&lt;-</span> <span class="va">pls_test_predict</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span><span class="va">pls_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pls_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pls_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pls_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">pls_table</span> <span class="op">&lt;-</span> <span class="va">pls_test_table</span></span>
<span><span class="va">pls_table_total</span> <span class="op">&lt;-</span> <span class="va">pls_table_total</span> <span class="op">+</span> <span class="va">pls_table</span></span>
<span></span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pls_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">pls_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">pls_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 y_test</span></span>
<span><span class="co">#&gt; pls_test_predict Bad Good Medium</span></span>
<span><span class="co">#&gt;           Bad      0    0      0</span></span>
<span><span class="co">#&gt;           Good     0    0      0</span></span>
<span><span class="co">#&gt;           Medium  17   19     46</span></span>
<span><span class="co">#&gt; [1] 0.5609756</span></span></code></pre></div>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="penalized-discriminant-analysis-model" class="section level3" number="5.0.8">
<h3>
<span class="header-section-number">5.0.8</span> Penalized Discriminant Analysis Model<a class="anchor" aria-label="anchor" href="#penalized-discriminant-analysis-model"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://brian-j-smith.github.io/MachineShop/">MachineShop</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">pda_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pda_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pda_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pda_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pda_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">pda_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">pda_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">pda_train_fit</span> <span class="op">&lt;-</span> <span class="fu">MachineShop</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MachineShop/man/fit-methods.html">fit</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train01</span>, model <span class="op">=</span> <span class="st">"PDAModel"</span><span class="op">)</span></span>
<span><span class="va">pda_train_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pda_train_fit</span>, newdata <span class="op">=</span> <span class="va">train01</span><span class="op">)</span></span>
<span><span class="va">pda_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">pda_train_predict</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">pda_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">pda_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pda_train_table</span><span class="op">)</span></span>
<span><span class="va">pda_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pda_train_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">pda_test_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pda_train_fit</span>, newdata <span class="op">=</span> <span class="va">test01</span><span class="op">)</span></span>
<span><span class="va">pda_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">pda_test_predict</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">pda_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">pda_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">pda_test_table</span><span class="op">)</span></span>
<span><span class="va">pda_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pda_test_accuracy</span><span class="op">)</span></span>
<span><span class="va">pda_test_pred</span> <span class="op">&lt;-</span> <span class="va">pda_test_predict</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span><span class="va">pda_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pda_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pda_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">pda_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">pda_table</span> <span class="op">&lt;-</span> <span class="va">pda_test_table</span></span>
<span><span class="va">pda_table_total</span> <span class="op">&lt;-</span> <span class="va">pda_table_total</span> <span class="op">+</span> <span class="va">pda_table</span></span>
<span></span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pda_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">pda_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">pda_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 y_test</span></span>
<span><span class="co">#&gt; pda_test_predict Bad Good Medium</span></span>
<span><span class="co">#&gt;           Bad     15    0      4</span></span>
<span><span class="co">#&gt;           Good     0   12      6</span></span>
<span><span class="co">#&gt;           Medium   4    3     49</span></span>
<span><span class="co">#&gt; [1] 0.8172043</span></span></code></pre></div>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="random-forest-1" class="section level3" number="5.0.9">
<h3>
<span class="header-section-number">5.0.9</span> Random Forest<a class="anchor" aria-label="anchor" href="#random-forest-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/">randomForest</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">rf_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rf_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rf_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rf_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rf_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rf_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">rf_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">rf_train_fit</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">train</span>, y <span class="op">=</span> <span class="va">y_train</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="va">rf_train_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">rf_train_fit</span>, <span class="va">train</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">rf_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">rf_train_pred</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">rf_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">rf_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rf_train_table</span><span class="op">)</span></span>
<span><span class="va">rf_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rf_train_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">rf_test_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">rf_train_fit</span>, <span class="va">test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">rf_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">rf_test_pred</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">rf_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">rf_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rf_test_table</span><span class="op">)</span></span>
<span><span class="va">rf_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rf_test_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span><span class="va">rf_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">rf_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rf_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rf_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">rf_table</span> <span class="op">&lt;-</span> <span class="va">rf_test_table</span></span>
<span><span class="va">rf_table_total</span> <span class="op">&lt;-</span> <span class="va">rf_table_total</span> <span class="op">+</span> <span class="va">rf_table</span></span>
<span></span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">rf_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">rf_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">rf_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;             y_test</span></span>
<span><span class="co">#&gt; rf_test_pred Bad Good Medium</span></span>
<span><span class="co">#&gt;       Bad      6    0      8</span></span>
<span><span class="co">#&gt;       Good     1   18      3</span></span>
<span><span class="co">#&gt;       Medium  16   12     56</span></span>
<span><span class="co">#&gt; [1] 0.6666667</span></span></code></pre></div>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="ranger" class="section level3" number="5.0.10">
<h3>
<span class="header-section-number">5.0.10</span> Ranger<a class="anchor" aria-label="anchor" href="#ranger"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://brian-j-smith.github.io/MachineShop/">MachineShop</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">ranger_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">ranger_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">ranger_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">ranger_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">ranger_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">ranger_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">ranger_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">ranger_train_fit</span> <span class="op">&lt;-</span> <span class="fu">MachineShop</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MachineShop/man/fit-methods.html">fit</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train01</span>, model <span class="op">=</span> <span class="st">"RangerModel"</span><span class="op">)</span></span>
<span><span class="va">ranger_train_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">ranger_train_fit</span>, newdata <span class="op">=</span> <span class="va">train01</span><span class="op">)</span></span>
<span><span class="va">ranger_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">ranger_train_predict</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">ranger_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">ranger_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">ranger_train_table</span><span class="op">)</span></span>
<span><span class="va">ranger_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ranger_train_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">ranger_test_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">ranger_train_fit</span>, newdata <span class="op">=</span> <span class="va">test01</span><span class="op">)</span></span>
<span><span class="va">ranger_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">ranger_test_predict</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">ranger_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">ranger_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">ranger_test_table</span><span class="op">)</span></span>
<span><span class="va">ranger_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ranger_test_accuracy</span><span class="op">)</span></span>
<span><span class="va">ranger_test_pred</span> <span class="op">&lt;-</span> <span class="va">ranger_test_predict</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span><span class="va">ranger_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ranger_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ranger_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ranger_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">ranger_table</span> <span class="op">&lt;-</span> <span class="va">ranger_test_table</span></span>
<span><span class="va">ranger_table_total</span> <span class="op">&lt;-</span> <span class="va">ranger_table_total</span> <span class="op">+</span> <span class="va">ranger_table</span></span>
<span></span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">ranger_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ranger_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">ranger_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    y_test</span></span>
<span><span class="co">#&gt; ranger_test_predict Bad Good Medium</span></span>
<span><span class="co">#&gt;              Bad      2    1      3</span></span>
<span><span class="co">#&gt;              Good     1    8      3</span></span>
<span><span class="co">#&gt;              Medium  16   18     43</span></span>
<span><span class="co">#&gt; [1] 0.5578947</span></span></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="regularized-discriminant-analysis" class="section level3" number="5.0.11">
<h3>
<span class="header-section-number">5.0.11</span> Regularized Discriminant Analysis<a class="anchor" aria-label="anchor" href="#regularized-discriminant-analysis"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://statistik.tu-dortmund.de">klaR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: MASS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'MASS'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     select</span></span></code></pre></div>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">rda_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rda_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rda_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rda_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rda_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rda_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">rda_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">rda_train_fit</span> <span class="op">&lt;-</span> <span class="fu">klaR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/klaR/man/rda.html">rda</a></span><span class="op">(</span><span class="va">y_train</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">rda_train_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">rda_train_fit</span>, newdata <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">rda_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">rda_train_pred</span><span class="op">$</span><span class="va">class</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">rda_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">rda_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rda_train_table</span><span class="op">)</span></span>
<span><span class="va">rda_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rda_train_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">rda_test_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">rda_train_fit</span>, newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span>
<span><span class="va">rda_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">rda_test_pred</span><span class="op">$</span><span class="va">class</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">rda_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">rda_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rda_test_table</span><span class="op">)</span></span>
<span><span class="va">rda_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rda_test_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span><span class="va">rda_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">rda_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rda_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rda_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">rda_table</span> <span class="op">&lt;-</span> <span class="va">rda_test_table</span></span>
<span><span class="va">rda_table_total</span> <span class="op">&lt;-</span> <span class="va">rda_table_total</span> <span class="op">+</span> <span class="va">rda_table</span></span>
<span></span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">rda_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">rda_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">rda_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;         y_test</span></span>
<span><span class="co">#&gt;          Bad Good Medium</span></span>
<span><span class="co">#&gt;   Bad      0    0      0</span></span>
<span><span class="co">#&gt;   Good     0    0      0</span></span>
<span><span class="co">#&gt;   Medium  16   22     55</span></span>
<span><span class="co">#&gt; [1] 0.5913978</span></span></code></pre></div>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="rpart-1" class="section level3" number="5.0.12">
<h3>
<span class="header-section-number">5.0.12</span> Rpart<a class="anchor" aria-label="anchor" href="#rpart-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://brian-j-smith.github.io/MachineShop/">MachineShop</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">rpart_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rpart_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rpart_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rpart_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rpart_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">rpart_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">rpart_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">rpart_train_fit</span> <span class="op">&lt;-</span> <span class="fu">MachineShop</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MachineShop/man/fit-methods.html">fit</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train01</span>, model <span class="op">=</span> <span class="st">"RPartModel"</span><span class="op">)</span></span>
<span><span class="va">rpart_train_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">rpart_train_fit</span>, newdata <span class="op">=</span> <span class="va">train01</span><span class="op">)</span></span>
<span><span class="va">rpart_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">rpart_train_predict</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">rpart_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">rpart_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rpart_train_table</span><span class="op">)</span></span>
<span><span class="va">rpart_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rpart_train_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">rpart_test_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">rpart_train_fit</span>, newdata <span class="op">=</span> <span class="va">test01</span><span class="op">)</span></span>
<span><span class="va">rpart_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">rpart_test_predict</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">rpart_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">rpart_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rpart_test_table</span><span class="op">)</span></span>
<span><span class="va">rpart_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rpart_test_accuracy</span><span class="op">)</span></span>
<span><span class="va">rpart_test_pred</span> <span class="op">&lt;-</span> <span class="va">rpart_test_predict</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span><span class="va">rpart_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">rpart_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rpart_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rpart_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">rpart_table</span> <span class="op">&lt;-</span> <span class="va">rpart_test_table</span></span>
<span><span class="va">rpart_table_total</span> <span class="op">&lt;-</span> <span class="va">rpart_table_total</span> <span class="op">+</span> <span class="va">rpart_table</span></span>
<span>  </span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">rpart_table_total</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">rpart_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">rpart_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   y_test</span></span>
<span><span class="co">#&gt; rpart_test_predict Bad Good Medium</span></span>
<span><span class="co">#&gt;             Bad     11    1     11</span></span>
<span><span class="co">#&gt;             Good     1   14      9</span></span>
<span><span class="co">#&gt;             Medium  11    4     35</span></span>
<span><span class="co">#&gt; [1] 0.6185567</span></span></code></pre></div>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="support-vector-machines-1" class="section level3" number="5.0.13">
<h3>
<span class="header-section-number">5.0.13</span> Support Vector Machines<a class="anchor" aria-label="anchor" href="#support-vector-machines-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">e1071</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">svm_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">svm_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">svm_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">svm_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">svm_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">svm_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">svm_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">svm_train_fit</span> <span class="op">&lt;-</span> <span class="fu">e1071</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html">svm</a></span><span class="op">(</span><span class="va">y_train</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span>, kernel <span class="op">=</span> <span class="st">"radial"</span>, gamma <span class="op">=</span> <span class="fl">1</span>, cost <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">svm_train_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">svm_train_fit</span>, <span class="va">train</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">svm_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">svm_train_pred</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">svm_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">svm_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">svm_train_table</span><span class="op">)</span></span>
<span><span class="va">svm_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">svm_train_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">svm_test_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">svm_train_fit</span>, <span class="va">test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">svm_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">svm_test_pred</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">svm_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">svm_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">svm_test_table</span><span class="op">)</span></span>
<span><span class="va">svm_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">svm_test_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span><span class="va">svm_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">svm_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">svm_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">svm_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">svm_table</span> <span class="op">&lt;-</span> <span class="va">svm_test_table</span></span>
<span><span class="va">svm_table_total</span> <span class="op">&lt;-</span> <span class="va">svm_table_total</span> <span class="op">+</span> <span class="va">svm_table</span></span>
<span></span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">svm_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">svm_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">svm_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;              y_test</span></span>
<span><span class="co">#&gt; svm_test_pred Bad Good Medium</span></span>
<span><span class="co">#&gt;        Bad      0    0      0</span></span>
<span><span class="co">#&gt;        Good     0    0      0</span></span>
<span><span class="co">#&gt;        Medium  29   21     51</span></span>
<span><span class="co">#&gt; [1] 0.5049505</span></span></code></pre></div>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="trees-1" class="section level3" number="5.0.14">
<h3>
<span class="header-section-number">5.0.14</span> Trees<a class="anchor" aria-label="anchor" href="#trees-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">tree_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">tree_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">tree_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">tree_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">tree_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">tree_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">tree_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">tree_train_fit</span> <span class="op">&lt;-</span> <span class="fu">tree</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tree/man/tree.html">tree</a></span><span class="op">(</span><span class="va">y_train</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">tree_train_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">tree_train_fit</span>, <span class="va">train</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">tree_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">tree_train_pred</span>, <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">tree_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">tree_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tree_train_table</span><span class="op">)</span></span>
<span><span class="va">tree_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tree_train_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">tree_test_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">tree_train_fit</span>, <span class="va">test</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">tree_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">tree_test_pred</span>, <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">tree_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">tree_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">tree_test_table</span><span class="op">)</span></span>
<span><span class="va">tree_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tree_test_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span><span class="va">tree_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tree_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tree_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tree_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">tree_table</span> <span class="op">&lt;-</span> <span class="va">tree_test_table</span></span>
<span><span class="va">tree_table_total</span> <span class="op">&lt;-</span> <span class="va">tree_table_total</span> <span class="op">+</span> <span class="va">tree_table</span>  </span>
<span></span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tree_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tree_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">tree_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;               y_test</span></span>
<span><span class="co">#&gt; tree_test_pred Bad Good Medium</span></span>
<span><span class="co">#&gt;         Bad     10    0     11</span></span>
<span><span class="co">#&gt;         Good     2   11      8</span></span>
<span><span class="co">#&gt;         Medium   6    7     42</span></span>
<span><span class="co">#&gt; [1] 0.6494845</span></span></code></pre></div>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="xgboost-1" class="section level3" number="5.0.15">
<h3>
<span class="header-section-number">5.0.15</span> XGBoost<a class="anchor" aria-label="anchor" href="#xgboost-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Load libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmlc/xgboost">xgboost</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'xgboost'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     slice</span></span></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span><span class="va">xgb_train_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">xgb_test_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">xgb_accuracy</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">xgb_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">xgb_holdout</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">xgb_table_total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Build the function, functionname &lt;- function(data, colnum, numresamples, train_amount, test_amount){</span></span>
<span><span class="va">xgb_1</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">colnum</span>, <span class="va">numresamples</span>, <span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span><span class="co"># Change target column name to y</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">colnum</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"y"</span></span>
<span><span class="co"># </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">y</span>, .after <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># Moves the target column to the last column on the right</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Set up resamples:</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">numresamples</span><span class="op">)</span> <span class="op">{</span></span>
<span> </span>
<span><span class="co"># Randomize the rows  </span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Split the data into train and test sets</span></span>
<span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">train_amount</span>, <span class="va">test_amount</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">train01</span> <span class="op">&lt;-</span> <span class="va">train</span></span>
<span><span class="va">test01</span> <span class="op">&lt;-</span> <span class="va">test</span></span>
<span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">train</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="va">test</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">index</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model on the training data</span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">train01</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">test01</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">X_train</span> <span class="op">&lt;-</span> <span class="va">train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">X_test</span> <span class="op">&lt;-</span> <span class="va">test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xgb_train</span> <span class="op">&lt;-</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.DMatrix.html">xgb.DMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">X_train</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">xgb_test</span> <span class="op">&lt;-</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.DMatrix.html">xgb.DMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">X_test</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">xgb_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    booster <span class="op">=</span> <span class="st">"gbtree"</span>,</span>
<span>    eta <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>    max_depth <span class="op">=</span> <span class="fl">8</span>,</span>
<span>    gamma <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    subsample <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>    colsample_bytree <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    objective <span class="op">=</span> <span class="st">"multi:softprob"</span>,</span>
<span>    eval_metric <span class="op">=</span> <span class="st">"mlogloss"</span>,</span>
<span>    num_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">xgb_model</span> <span class="op">&lt;-</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.train.html">xgb.train</a></span><span class="op">(</span></span>
<span>    params <span class="op">=</span> <span class="va">xgb_params</span>,</span>
<span>    data <span class="op">=</span> <span class="va">xgb_train</span>,</span>
<span>    nrounds <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>    verbose <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">xgb_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">xgb_model</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">X_train</span><span class="op">)</span>, reshape <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">xgb_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">xgb_preds</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">xgb_preds</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xgb_preds</span><span class="op">$</span><span class="va">PredictedClass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">xgb_preds</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">xgb_preds</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">xgb_preds</span><span class="op">$</span><span class="va">ActualClass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="va">y_train</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">xgb_train_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">xgb_preds</span><span class="op">$</span><span class="va">PredictedClass</span>, <span class="va">xgb_preds</span><span class="op">$</span><span class="va">ActualClass</span><span class="op">)</span></span>
<span><span class="va">xgb_train_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">xgb_train_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">xgb_train_table</span><span class="op">)</span></span>
<span><span class="va">xgb_train_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">xgb_train_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check accuracy and make predictions from the model, applied to the test data</span></span>
<span><span class="va">y_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">train01</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">y_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">test01</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">X_train</span> <span class="op">&lt;-</span> <span class="va">train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">X_test</span> <span class="op">&lt;-</span> <span class="va">test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xgb_train</span> <span class="op">&lt;-</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.DMatrix.html">xgb.DMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">X_train</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">y_train</span><span class="op">)</span></span>
<span><span class="va">xgb_test</span> <span class="op">&lt;-</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.DMatrix.html">xgb.DMatrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">X_test</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">y_test</span><span class="op">)</span></span>
<span><span class="va">xgb_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    booster <span class="op">=</span> <span class="st">"gbtree"</span>,</span>
<span>    eta <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>    max_depth <span class="op">=</span> <span class="fl">8</span>,</span>
<span>    gamma <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    subsample <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>    colsample_bytree <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    objective <span class="op">=</span> <span class="st">"multi:softprob"</span>,</span>
<span>    eval_metric <span class="op">=</span> <span class="st">"mlogloss"</span>,</span>
<span>    num_class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">xgb_model</span> <span class="op">&lt;-</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.train.html">xgb.train</a></span><span class="op">(</span></span>
<span>    params <span class="op">=</span> <span class="va">xgb_params</span>,</span>
<span>    data <span class="op">=</span> <span class="va">xgb_train</span>,</span>
<span>    nrounds <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>    verbose <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">xgb_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">xgb_model</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">X_test</span><span class="op">)</span>, reshape <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">xgb_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">xgb_preds</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">xgb_preds</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xgb_preds</span><span class="op">$</span><span class="va">PredictedClass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">xgb_preds</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">xgb_preds</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">xgb_preds</span><span class="op">$</span><span class="va">ActualClass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="va">y_test</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">xgb_test_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">xgb_preds</span><span class="op">$</span><span class="va">PredictedClass</span>, <span class="va">xgb_preds</span><span class="op">$</span><span class="va">ActualClass</span><span class="op">)</span></span>
<span><span class="va">xgb_test_accuracy</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">xgb_test_table</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">xgb_test_table</span><span class="op">)</span></span>
<span><span class="va">xgb_test_accuracy_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">xgb_test_accuracy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate overall model accuracy</span></span>
<span><span class="va">xgb_holdout</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">xgb_test_accuracy_mean</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">xgb_holdout_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">xgb_holdout</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate table</span></span>
<span><span class="va">xgb_table</span> <span class="op">&lt;-</span> <span class="va">xgb_test_table</span></span>
<span><span class="va">xgb_table_total</span> <span class="op">&lt;-</span> <span class="va">xgb_table_total</span> <span class="op">+</span> <span class="va">xgb_table</span></span>
<span></span>
<span><span class="co"># Print table results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">xgb_table_total</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Return accuracy results</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">xgb_holdout_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span> <span class="co"># Closing braces for numresamples loop</span></span>
<span><span class="op">}</span> <span class="co"># Closing brace for classification1 function</span></span>
<span></span>
<span><span class="co"># Test the function</span></span>
<span><span class="fu">xgb_1</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">ISLR</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ISLR/man/Carseats.html">Carseats</a></span>, colnum <span class="op">=</span> <span class="fl">7</span>, numresamples <span class="op">=</span> <span class="fl">5</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, test_amount <span class="op">=</span> <span class="fl">0.20</span><span class="op">)</span></span>
<span><span class="co">#&gt;         </span></span>
<span><span class="co">#&gt;          Bad Good Medium</span></span>
<span><span class="co">#&gt;   Bad      2    0      2</span></span>
<span><span class="co">#&gt;   Good     0   12      4</span></span>
<span><span class="co">#&gt;   Medium  24   11     40</span></span>
<span><span class="co">#&gt; [1] 0.5684211</span></span></code></pre></div>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Check for errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="post-your-results" class="section level3" number="5.0.16">
<h3>
<span class="header-section-number">5.0.16</span> Post your results<a class="anchor" aria-label="anchor" href="#post-your-results"><i class="fas fa-link"></i></a>
</h3>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="building-weighted-ensembles-to-model-numerical-data.html"><span class="header-section-number">4</span> Building weighted ensembles to model numerical data</a></div>
<div class="next"><a href="building-ensembles-of-classification-models.html"><span class="header-section-number">6</span> Building ensembles of classification models</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav"><li>
<a class="nav-link" href="#classification-data-how-to-make-14-individual-classification-models"><span class="header-section-number">5</span> Classification data: How to make 14 individual classification models</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#what-is-classification-data"><span class="header-section-number">5.0.1</span> What is classification data?</a></li>
<li><a class="nav-link" href="#build-our-first-classification-model-from-the-structure"><span class="header-section-number">5.0.2</span> Build our first classification model from the structure:</a></li>
<li><a class="nav-link" href="#adabag-for-classification-data"><span class="header-section-number">5.0.3</span> Adabag for classification data</a></li>
<li><a class="nav-link" href="#bagged-random-forest-1"><span class="header-section-number">5.0.4</span> Bagged Random Forest</a></li>
<li><a class="nav-link" href="#linear-model"><span class="header-section-number">5.0.5</span> Linear model</a></li>
<li><a class="nav-link" href="#naive-bayes-model"><span class="header-section-number">5.0.6</span> Naive Bayes model</a></li>
<li><a class="nav-link" href="#partial-least-squares-1"><span class="header-section-number">5.0.7</span> Partial Least Squares</a></li>
<li><a class="nav-link" href="#penalized-discriminant-analysis-model"><span class="header-section-number">5.0.8</span> Penalized Discriminant Analysis Model</a></li>
<li><a class="nav-link" href="#random-forest-1"><span class="header-section-number">5.0.9</span> Random Forest</a></li>
<li><a class="nav-link" href="#ranger"><span class="header-section-number">5.0.10</span> Ranger</a></li>
<li><a class="nav-link" href="#regularized-discriminant-analysis"><span class="header-section-number">5.0.11</span> Regularized Discriminant Analysis</a></li>
<li><a class="nav-link" href="#rpart-1"><span class="header-section-number">5.0.12</span> Rpart</a></li>
<li><a class="nav-link" href="#support-vector-machines-1"><span class="header-section-number">5.0.13</span> Support Vector Machines</a></li>
<li><a class="nav-link" href="#trees-1"><span class="header-section-number">5.0.14</span> Trees</a></li>
<li><a class="nav-link" href="#xgboost-1"><span class="header-section-number">5.0.15</span> XGBoost</a></li>
<li><a class="nav-link" href="#post-your-results"><span class="header-section-number">5.0.16</span> Post your results</a></li>
</ul>
</li></ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/InfinteCuriosity/EnsemblesBook/blob/master/04-Individual_Classification_Models.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/InfinteCuriosity/EnsemblesBook/edit/master/04-Individual_Classification_Models.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Ensembles: From Beginner to Expert</strong>" was written by Russ Conte. It was last built on 2024-06-03.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
