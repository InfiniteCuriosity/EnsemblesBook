<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 How to Make 27 Individual Forecasting Models | Ensembles: From Beginner to Expert</title>
<meta name="author" content="Russ Conte">
<meta name="description" content="This chapter builds time series models. This is also known as forecasting, the professional organization is named the International Institute of Forecasters, and their website is...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Chapter 9 How to Make 27 Individual Forecasting Models | Ensembles: From Beginner to Expert">
<meta property="og:type" content="book">
<meta property="og:description" content="This chapter builds time series models. This is also known as forecasting, the professional organization is named the International Institute of Forecasters, and their website is...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 9 How to Make 27 Individual Forecasting Models | Ensembles: From Beginner to Expert">
<meta name="twitter:description" content="This chapter builds time series models. This is also known as forecasting, the professional organization is named the International Institute of Forecasters, and their website is...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Ensembles: From Beginner to Expert</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome!</a></li>
<li><a class="" href="introduction-and-your-first-ensembles.html"><span class="header-section-number">2</span> Introduction and your first ensembles</a></li>
<li><a class="" href="numerical-data-how-to-make-23-individual-models-and-basic-skills-with-functions.html"><span class="header-section-number">3</span> Numerical data: How to make 23 individual models, and basic skills with functions</a></li>
<li><a class="" href="building-weighted-ensembles-to-model-numerical-data.html"><span class="header-section-number">4</span> Building weighted ensembles to model numerical data</a></li>
<li><a class="" href="classification-data-how-to-make-14-individual-classification-models.html"><span class="header-section-number">5</span> Classification data: How to make 14 individual classification models</a></li>
<li><a class="" href="building-ensembles-of-classification-models.html"><span class="header-section-number">6</span> Building ensembles of classification models</a></li>
<li><a class="" href="individual-logistic-models.html"><span class="header-section-number">7</span> Individual logistic models</a></li>
<li><a class="" href="advice-to-lebron-james-and-everyone-who-does-talent-analytics-logistic-ensembles.html"><span class="header-section-number">8</span> Advice to Lebron James (and everyone who does talent analytics): Logistic ensembles</a></li>
<li><a class="active" href="how-to-make-27-individual-forecasting-models.html"><span class="header-section-number">9</span> How to Make 27 Individual Forecasting Models</a></li>
<li><a class="" href="ensembles-of-26-forecasting-models.html"><span class="header-section-number">10</span> Ensembles of 26 Forecasting Models</a></li>
<li><a class="" href="predicting-on-totally-new-data-with-individual-models-and-ensembles.html"><span class="header-section-number">11</span> Predicting on totally new data with individual models and ensembles</a></li>
<li><a class="" href="how-to-communicate-your-results.html"><span class="header-section-number">12</span> How to communicate your results</a></li>
<li><a class="" href="final-comprhensive-project.html"><span class="header-section-number">13</span> Final Comprhensive Project</a></li>
<li><a class="" href="summary-and-charge-to-the-graduates-of-the-class.html"><span class="header-section-number">14</span> Summary and Charge to the Graduates of the Class!</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/InfinteCuriosity/EnsemblesBook">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="how-to-make-27-individual-forecasting-models" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> How to Make 27 Individual Forecasting Models<a class="anchor" aria-label="anchor" href="#how-to-make-27-individual-forecasting-models"><i class="fas fa-link"></i></a>
</h1>
<p>This chapter builds time series models. This is also known as forecasting, the professional organization is named the International Institute of Forecasters, and their website is <a href="https://forecasters.org" class="uri">https://forecasters.org</a>. I strongly recommend checking the IIF, I’ve found it to be a very good source of skills and knowledge when it comes to forecasting.</p>
<p>In this chapter we are going to build 16 forecasting models. There are a few large groups of models, with variations within each of the groups. For example, we will use (or not use) seasonality in the model making process.</p>
<p>We’ll follow the same pattern/process we’ve been following in the previous sections:</p>
<blockquote>
<p>Load the library</p>
<p>Set initial values to 0</p>
<p>Create the function</p>
<p>Break the data into train and test sets</p>
<p>Set up random resampling</p>
<p>Fit the model on the training data, make predictions and measure error on the test data</p>
<p>Return the results</p>
<p>Check for errors or warnings</p>
<p>Test on a different data set</p>
</blockquote>
<p>The first step is to load the library In the case of time series forecasting, the library is the excellent FPP3 library. There is an excellent book available that guides the learner through the time series process. The book is Forecasting Principles and Practice. It is currently in its third edition, and I recommend it very highly. The website for the book is:</p>
<p><a href="https://otexts.com/fpp3/" class="uri">https://otexts.com/fpp3/</a></p>
<p>The time series data we will use is the most important data that is published on a regular bases by the United States federal government: The monthly labor report. There is a large set of time series data sets at the Bureau of Labor Statistics website:</p>
<p><a href="https://www.bls.gov" class="uri">https://www.bls.gov</a></p>
<p>The top picks of time series data are here:</p>
<p><a href="https://data.bls.gov/cgi-bin/surveymost?ce" class="uri">https://data.bls.gov/cgi-bin/surveymost?ce</a></p>
<p>For our work here we will only be looking at one data set, but it’s by far the most watched result: Total nonfarm employment. The data can be found here:</p>
<p><a href="https://data.bls.gov/timeseries/CES0000000001" class="uri">https://data.bls.gov/timeseries/CES0000000001</a></p>
<p>I have the data stored on my Github repository, and w will be accessing that data, but there are other ways the data may be retrieved. If you plan to use this a lot, consider registering for the Application Program Interface (API) for the time series data. More information about the API and directions to register is available at:</p>
<p><a href="https://www.bls.gov/developers/" class="uri">https://www.bls.gov/developers/</a></p>
<div class="float">
<img src="_book/images/All_data_connects_to_people.jpg" alt="All data is about people"><div class="figcaption">All data is about people</div>
</div>
<div id="individual-time-series-models" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> 12 Individual Time Series Models<a class="anchor" aria-label="anchor" href="#individual-time-series-models"><i class="fas fa-link"></i></a>
</h2>
<div id="arima-1" class="section level3" number="9.1.1">
<h3>
<span class="header-section-number">9.1.1</span> Arima 1<a class="anchor" aria-label="anchor" href="#arima-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching packages ────────────────────────── fpp3 0.5 ──</span></span>
<span><span class="co">#&gt; ✔ tibble      3.2.1     ✔ tsibble     1.1.4</span></span>
<span><span class="co">#&gt; ✔ dplyr       1.1.4     ✔ tsibbledata 0.4.1</span></span>
<span><span class="co">#&gt; ✔ tidyr       1.3.1     ✔ feasts      0.3.2</span></span>
<span><span class="co">#&gt; ✔ lubridate   1.9.3     ✔ fable       0.3.4</span></span>
<span><span class="co">#&gt; ✔ ggplot2     3.5.1     ✔ fabletools  0.4.2</span></span>
<span><span class="co">#&gt; ── Conflicts ───────────────────────────── fpp3_conflicts ──</span></span>
<span><span class="co">#&gt; ✖ lubridate::date()    masks base::date()</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter()      masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ tsibble::intersect() masks base::intersect()</span></span>
<span><span class="co">#&gt; ✖ tsibble::interval()  masks lubridate::interval()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()         masks stats::lag()</span></span>
<span><span class="co">#&gt; ✖ tsibble::setdiff()   masks base::setdiff()</span></span>
<span><span class="co">#&gt; ✖ tsibble::union()     masks base::union()</span></span></code></pre></div>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Set initial values to 0</span></span>
<span></span>
<span><span class="co"># Set up function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Build the model</span></span>
<span><span class="va">Arima1_model</span> <span class="op">=</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ARIMA.html">ARIMA</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">season</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">trend</span><span class="op">(</span><span class="op">)</span>,stepwise <span class="op">=</span> <span class="cn">TRUE</span>, greedy <span class="op">=</span> <span class="cn">TRUE</span>, approximation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate error rate</span></span>
<span><span class="va">Arima1_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Arima1_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make predictions on the holdout/test data</span></span>
<span><span class="va">Arima1_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Arima1_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Report the predictions</span></span>
<span><span class="va">Arima1_prediction_model</span> <span class="op">&lt;-</span> <span class="va">Arima1_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">Arima1_prediction_date</span><span class="op">&lt;-</span> <span class="va">Arima1_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">Arima1_prediction_range</span> <span class="op">&lt;-</span> <span class="va">Arima1_predictions</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">Arima1_prediction_mean</span> <span class="op">&lt;-</span><span class="va">Arima1_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Arima1_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Arima1_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>  <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Arima1_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>  <span class="st">'Forecast'</span> <span class="op">=</span> <span class="va">Arima1_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;         .model    Error     Date     .mean</span></span>
<span><span class="co">#&gt; 1 Arima1_model 58.39161 2024 May  740.0623</span></span>
<span><span class="co">#&gt; 2 Arima1_model 58.39161 2024 Jun 1029.3480</span></span>
<span><span class="co">#&gt; 3 Arima1_model 58.39161 2024 Jul  586.4908</span></span></code></pre></div>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="arima-2" class="section level3" number="9.1.2">
<h3>
<span class="header-section-number">9.1.2</span> Arima 2<a class="anchor" aria-label="anchor" href="#arima-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">Arima2_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ARIMA.html">ARIMA</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">season</span><span class="op">(</span><span class="op">)</span>, stepwise <span class="op">=</span> <span class="cn">TRUE</span>, greedy <span class="op">=</span> <span class="cn">TRUE</span>, approximation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate error rate</span></span>
<span><span class="va">Arima2_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Arima2_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make predictions on the holdout/test data</span></span>
<span><span class="va">Arima2_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>    <span class="va">Arima2_model</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Report the predictions</span></span>
<span><span class="va">Arima2_prediction_model</span> <span class="op">&lt;-</span> <span class="va">Arima2_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">Arima2_prediction_date</span><span class="op">&lt;-</span> <span class="va">Arima2_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">Arima2_prediction_range</span> <span class="op">&lt;-</span> <span class="va">Arima2_predictions</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">Arima2_prediction_mean</span> <span class="op">&lt;-</span><span class="va">Arima2_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Arima2_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Arima2_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>  <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Arima2_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>  <span class="st">'Forecast'</span> <span class="op">=</span> <span class="va">Arima2_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;         .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Arima2_model 54.98322 2024 May 623.5714</span></span>
<span><span class="co">#&gt; 2 Arima2_model 54.98322 2024 Jun 912.8571</span></span>
<span><span class="co">#&gt; 3 Arima2_model 54.98322 2024 Jul 470.0000</span></span></code></pre></div>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="arima3" class="section level3" number="9.1.3">
<h3>
<span class="header-section-number">9.1.3</span> Arima3<a class="anchor" aria-label="anchor" href="#arima3"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Create the model:</span></span>
<span><span class="va">Arima3_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ARIMA.html">ARIMA</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">trend</span><span class="op">(</span><span class="op">)</span>,stepwise <span class="op">=</span> <span class="cn">TRUE</span>, greedy <span class="op">=</span> <span class="cn">TRUE</span>, approximation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the error:</span></span>
<span><span class="va">Arima3_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Arima3_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the forecast:</span></span>
<span><span class="va">Arima3_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Arima3_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Report the predictions:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Arima3_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Arima3_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>  <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Arima3_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>  <span class="st">'Forecast'</span> <span class="op">=</span> <span class="va">Arima3_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;         .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Arima3_model 46.96308 2024 May 196.6640</span></span>
<span><span class="co">#&gt; 2 Arima3_model 46.96308 2024 Jun 197.5579</span></span>
<span><span class="co">#&gt; 3 Arima3_model 46.96308 2024 Jul 198.4518</span></span></code></pre></div>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="arima4" class="section level3" number="9.1.4">
<h3>
<span class="header-section-number">9.1.4</span> Arima4<a class="anchor" aria-label="anchor" href="#arima4"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="co"># Create the model:</span></span>
<span><span class="va">Arima4_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ARIMA.html">ARIMA</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">trend</span><span class="op">(</span><span class="op">)</span>,stepwise <span class="op">=</span> <span class="cn">TRUE</span>, greedy <span class="op">=</span> <span class="cn">TRUE</span>, approximation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Arima4_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Arima4_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Arima4_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Arima4_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Arima4_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Arima4_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Arima4_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Forecast'</span> <span class="op">=</span> <span class="va">Arima4_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;         .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Arima4_model 46.96308 2024 May 196.6640</span></span>
<span><span class="co">#&gt; 2 Arima4_model 46.96308 2024 Jun 197.5579</span></span>
<span><span class="co">#&gt; 3 Arima4_model 46.96308 2024 Jul 198.4518</span></span></code></pre></div>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="deterministic" class="section level3" number="9.1.5">
<h3>
<span class="header-section-number">9.1.5</span> Deterministic<a class="anchor" aria-label="anchor" href="#deterministic"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span><span class="va">Deterministic_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ARIMA.html">ARIMA</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span>  <span class="fl">1</span> <span class="op">+</span> <span class="fu">pdq</span><span class="op">(</span>d <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Calculate the error:</span></span>
<span><span class="va">Deterministic_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Deterministic_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Calculate the forecast:</span></span>
<span><span class="va">Deterministic_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Deterministic_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Report the predictions:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Deterministic_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Deterministic_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Deterministic_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Forecast'</span> <span class="op">=</span> <span class="va">Deterministic_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Deterministic_model 42.86143 2024 May 146.3409</span></span>
<span><span class="co">#&gt; 2 Deterministic_model 42.86143 2024 Jun 146.3409</span></span>
<span><span class="co">#&gt; 3 Deterministic_model 42.86143 2024 Jul 146.3409</span></span></code></pre></div>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="drift" class="section level3" number="9.1.6">
<h3>
<span class="header-section-number">9.1.6</span> Drift<a class="anchor" aria-label="anchor" href="#drift"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="co"># Create the model:</span></span>
<span><span class="va">Drift_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/RW.html">SNAIVE</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">drift</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the error:</span></span>
<span><span class="va">Drift_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Drift_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Calculate the forecast:</span></span>
<span><span class="va">Drift_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Drift_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Report the predictions:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Drift_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Drift_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Drift_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Range'</span> <span class="op">=</span> <span class="va">Drift_predictions</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Drift_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;        .model    Error     Date            Difference</span></span>
<span><span class="co">#&gt; 1 Drift_model 99.09185 2024 May N(287.3684, 12520161)</span></span>
<span><span class="co">#&gt; 2 Drift_model 99.09185 2024 Jun N(191.3684, 12520161)</span></span>
<span><span class="co">#&gt; 3 Drift_model 99.09185 2024 Jul N(193.3684, 12520161)</span></span>
<span><span class="co">#&gt;      .mean</span></span>
<span><span class="co">#&gt; 1 287.3684</span></span>
<span><span class="co">#&gt; 2 191.3684</span></span>
<span><span class="co">#&gt; 3 193.3684</span></span></code></pre></div>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="ets1" class="section level3" number="9.1.7">
<h3>
<span class="header-section-number">9.1.7</span> ETS1<a class="anchor" aria-label="anchor" href="#ets1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="co"># Create the model:</span></span>
<span><span class="va">ETS1_model</span> <span class="op">&lt;-</span>   <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ETS.html">ETS</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">season</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">trend</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the error:</span></span>
<span><span class="va">ETS1_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">ETS1_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Calculate the forecast:</span></span>
<span><span class="va">ETS1_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">ETS1_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Report the predictions:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">ETS1_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">ETS1_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">ETS1_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">ETS1_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;       .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 ETS1_model 42.98491 2024 May 189.8662</span></span>
<span><span class="co">#&gt; 2 ETS1_model 42.98491 2024 Jun 189.8662</span></span>
<span><span class="co">#&gt; 3 ETS1_model 42.98491 2024 Jul 189.8662</span></span></code></pre></div>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="ets2" class="section level3" number="9.1.8">
<h3>
<span class="header-section-number">9.1.8</span> ETS2<a class="anchor" aria-label="anchor" href="#ets2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="co"># Create the model:</span></span>
<span><span class="va">ETS2_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ETS.html">ETS</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">trend</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the error:</span></span>
<span><span class="va">ETS2_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">ETS2_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Calculate the forecast:</span></span>
<span><span class="va">ETS2_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">ETS2_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Report the predictions:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">ETS2_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">ETS2_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">ETS2_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">ETS2_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;       .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 ETS2_model 42.98491 2024 May 189.8662</span></span>
<span><span class="co">#&gt; 2 ETS2_model 42.98491 2024 Jun 189.8662</span></span>
<span><span class="co">#&gt; 3 ETS2_model 42.98491 2024 Jul 189.8662</span></span></code></pre></div>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="ets3" class="section level3" number="9.1.9">
<h3>
<span class="header-section-number">9.1.9</span> ETS3<a class="anchor" aria-label="anchor" href="#ets3"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="co"># Create the model:</span></span>
<span><span class="va">ETS3_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ETS.html">ETS</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">season</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the error:</span></span>
<span><span class="va">ETS3_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">ETS3_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Calculate the forecast:</span></span>
<span><span class="va">ETS3_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">ETS3_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Report the predictions:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">ETS3_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">ETS3_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">ETS3_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">ETS3_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;       .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 ETS3_model 42.98491 2024 May 189.8662</span></span>
<span><span class="co">#&gt; 2 ETS3_model 42.98491 2024 Jun 189.8662</span></span>
<span><span class="co">#&gt; 3 ETS3_model 42.98491 2024 Jul 189.8662</span></span></code></pre></div>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="ets4" class="section level3" number="9.1.10">
<h3>
<span class="header-section-number">9.1.10</span> ETS4<a class="anchor" aria-label="anchor" href="#ets4"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="co"># Create the model:</span></span>
<span><span class="va">ETS4_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ETS.html">ETS</a></span><span class="op">(</span><span class="va">Difference</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the error:</span></span>
<span><span class="va">ETS4_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">ETS4_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Calculate the forecast:</span></span>
<span><span class="va">ETS4_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">ETS4_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Report the predictions:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">ETS4_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">ETS4_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">ETS4_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">ETS4_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;       .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 ETS4_model 42.98491 2024 May 189.8662</span></span>
<span><span class="co">#&gt; 2 ETS4_model 42.98491 2024 Jun 189.8662</span></span>
<span><span class="co">#&gt; 3 ETS4_model 42.98491 2024 Jul 189.8662</span></span></code></pre></div>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="holt-winters-additive" class="section level3" number="9.1.11">
<h3>
<span class="header-section-number">9.1.11</span> Holt-Winters Additive<a class="anchor" aria-label="anchor" href="#holt-winters-additive"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="co"># Create the model:</span></span>
<span><span class="va">Holt_Winters_Additive_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ETS.html">ETS</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/kernlab/man/vm-class.html">error</a></span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">trend</span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">season</span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the error:</span></span>
<span><span class="va">Holt_Winters_Additive_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Holt_Winters_Additive_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Calculate the forecast:</span></span>
<span><span class="va">Holt_Winters_Additive_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Holt_Winters_Additive_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Report the predictions:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Holt_Winters_Additive_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Holt_Winters_Additive_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Holt_Winters_Additive_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Holt_Winters_Additive_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                        .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Holt_Winters_Additive_model 52.74689 2024 May 467.2980</span></span>
<span><span class="co">#&gt; 2 Holt_Winters_Additive_model 52.74689 2024 Jun 802.6268</span></span>
<span><span class="co">#&gt; 3 Holt_Winters_Additive_model 52.74689 2024 Jul 229.5501</span></span></code></pre></div>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="holt-winters-damped" class="section level3" number="9.1.12">
<h3>
<span class="header-section-number">9.1.12</span> Holt-Winters Damped<a class="anchor" aria-label="anchor" href="#holt-winters-damped"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="co"># Create the model:</span></span>
<span><span class="va">Holt_Winters_Damped_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ETS.html">ETS</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/kernlab/man/vm-class.html">error</a></span><span class="op">(</span><span class="st">"M"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">trend</span><span class="op">(</span><span class="st">"Ad"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">season</span><span class="op">(</span><span class="st">"M"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the error:</span></span>
<span><span class="va">Holt_Winters_Damped_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Holt_Winters_Damped_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Calculate the forecast:</span></span>
<span><span class="va">Holt_Winters_Damped_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Holt_Winters_Damped_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Report the predictions:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Holt_Winters_Damped_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Holt_Winters_Damped_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Holt_Winters_Damped_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Holt_Winters_Damped_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      .model    Error     Date     .mean</span></span>
<span><span class="co">#&gt; 1 Holt_Winters_Damped_model 481.2281 2024 May 137.36755</span></span>
<span><span class="co">#&gt; 2 Holt_Winters_Damped_model 481.2281 2024 Jun 116.40494</span></span>
<span><span class="co">#&gt; 3 Holt_Winters_Damped_model 481.2281 2024 Jul  97.76673</span></span></code></pre></div>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="holt-winters-multiplicative" class="section level3" number="9.1.13">
<h3>
<span class="header-section-number">9.1.13</span> Holt-Winters Multiplicative<a class="anchor" aria-label="anchor" href="#holt-winters-multiplicative"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="co"># Create the model:</span></span>
<span><span class="va">Holt_Winters_Multiplicative_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ETS.html">ETS</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/kernlab/man/vm-class.html">error</a></span><span class="op">(</span><span class="st">"M"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">trend</span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">season</span><span class="op">(</span><span class="st">"M"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the error:</span></span>
<span><span class="va">Holt_Winters_Multiplicative_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Holt_Winters_Multiplicative_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Calculate the forecast:</span></span>
<span><span class="va">Holt_Winters_Multiplicative_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Holt_Winters_Multiplicative_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Report the predictions:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Holt_Winters_Multiplicative_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Holt_Winters_Multiplicative_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Holt_Winters_Multiplicative_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Holt_Winters_Multiplicative_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                              .model    Error     Date</span></span>
<span><span class="co">#&gt; 1 Holt_Winters_Multiplicative_model 470.7401 2024 May</span></span>
<span><span class="co">#&gt; 2 Holt_Winters_Multiplicative_model 470.7401 2024 Jun</span></span>
<span><span class="co">#&gt; 3 Holt_Winters_Multiplicative_model 470.7401 2024 Jul</span></span>
<span><span class="co">#&gt;      .mean</span></span>
<span><span class="co">#&gt; 1 122.6052</span></span>
<span><span class="co">#&gt; 2 128.6342</span></span>
<span><span class="co">#&gt; 3 108.2321</span></span></code></pre></div>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="linear-1" class="section level3" number="9.1.14">
<h3>
<span class="header-section-number">9.1.14</span> Linear 1<a class="anchor" aria-label="anchor" href="#linear-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="co"># Split the data into train and test:</span></span>
<span><span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span><span class="co"># Create the model:</span></span>
<span><span class="va">Linear1_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ETS.html">ETS</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/kernlab/man/vm-class.html">error</a></span><span class="op">(</span><span class="st">"M"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">trend</span><span class="op">(</span><span class="st">"Ad"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">season</span><span class="op">(</span><span class="st">"M"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the error:</span></span>
<span><span class="va">Linear1_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Linear1_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Calculate the forecast:</span></span>
<span><span class="va">Linear1_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Linear1_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Report the predictions:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Linear1_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Linear1_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Linear1_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Linear1_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;          .model    Error     Date     .mean</span></span>
<span><span class="co">#&gt; 1 Linear1_model 481.2281 2024 May 137.36755</span></span>
<span><span class="co">#&gt; 2 Linear1_model 481.2281 2024 Jun 116.40494</span></span>
<span><span class="co">#&gt; 3 Linear1_model 481.2281 2024 Jul  97.76673</span></span></code></pre></div>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="linear-2" class="section level3" number="9.1.15">
<h3>
<span class="header-section-number">9.1.15</span> Linear 2<a class="anchor" aria-label="anchor" href="#linear-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Linear2_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/TSLM.html">TSLM</a></span><span class="op">(</span><span class="va">Difference</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Linear2_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Linear2_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Linear2_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Linear2_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Linear2_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Linear2_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Linear2_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Linear2_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;          .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Linear2_model 120.6944 2024 May 146.3409</span></span>
<span><span class="co">#&gt; 2 Linear2_model 120.6944 2024 Jun 146.3409</span></span>
<span><span class="co">#&gt; 3 Linear2_model 120.6944 2024 Jul 146.3409</span></span></code></pre></div>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="linear-3" class="section level3" number="9.1.16">
<h3>
<span class="header-section-number">9.1.16</span> Linear 3<a class="anchor" aria-label="anchor" href="#linear-3"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Linear2_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/TSLM.html">TSLM</a></span><span class="op">(</span><span class="va">Difference</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Linear2_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Linear2_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Linear2_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Linear2_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Linear2_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Linear2_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Linear2_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Linear2_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;          .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Linear2_model 120.6944 2024 May 146.3409</span></span>
<span><span class="co">#&gt; 2 Linear2_model 120.6944 2024 Jun 146.3409</span></span>
<span><span class="co">#&gt; 3 Linear2_model 120.6944 2024 Jul 146.3409</span></span></code></pre></div>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="linear-4" class="section level3" number="9.1.17">
<h3>
<span class="header-section-number">9.1.17</span> Linear 4<a class="anchor" aria-label="anchor" href="#linear-4"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Linear4_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/TSLM.html">TSLM</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">trend</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Linear4_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Linear4_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Linear4_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Linear4_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Linear4_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Linear4_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Linear4_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Linear4_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;          .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Linear4_model 87.83978 2024 May 313.7312</span></span>
<span><span class="co">#&gt; 2 Linear4_model 87.83978 2024 Jun 317.4928</span></span>
<span><span class="co">#&gt; 3 Linear4_model 87.83978 2024 Jul 321.2543</span></span></code></pre></div>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="mean" class="section level3" number="9.1.18">
<h3>
<span class="header-section-number">9.1.18</span> Mean<a class="anchor" aria-label="anchor" href="#mean"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Mean_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/MEAN.html">MEAN</a></span><span class="op">(</span><span class="va">Difference</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Mean_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Mean_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Mean_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Mean_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Mean_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Mean_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Mean_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Mean_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;       .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Mean_model 120.6944 2024 May 146.3409</span></span>
<span><span class="co">#&gt; 2 Mean_model 120.6944 2024 Jun 146.3409</span></span>
<span><span class="co">#&gt; 3 Mean_model 120.6944 2024 Jul 146.3409</span></span></code></pre></div>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="naive" class="section level3" number="9.1.19">
<h3>
<span class="header-section-number">9.1.19</span> Naive<a class="anchor" aria-label="anchor" href="#naive"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Naive_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/RW.html">NAIVE</a></span><span class="op">(</span><span class="va">Difference</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Naive_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Naive_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Naive_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Naive_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Naive_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Naive_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Naive_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Naive_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;        .model    Error     Date .mean</span></span>
<span><span class="co">#&gt; 1 Naive_model 52.38957 2024 May   175</span></span>
<span><span class="co">#&gt; 2 Naive_model 52.38957 2024 Jun   175</span></span>
<span><span class="co">#&gt; 3 Naive_model 52.38957 2024 Jul   175</span></span></code></pre></div>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="neuralnet-1" class="section level3" number="9.1.20">
<h3>
<span class="header-section-number">9.1.20</span> Neuralnet 1<a class="anchor" aria-label="anchor" href="#neuralnet-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Neuralnet1_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/NNETAR.html">NNETAR</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">season</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">trend</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Neuralnet1_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Neuralnet1_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Neuralnet1_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Neuralnet1_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Neuralnet1_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Neuralnet1_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Neuralnet1_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Neuralnet1_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;             .model    Error     Date      .mean</span></span>
<span><span class="co">#&gt; 1 Neuralnet1_model 80.01379 2024 May  254.58940</span></span>
<span><span class="co">#&gt; 2 Neuralnet1_model 80.01379 2024 Jun   31.16869</span></span>
<span><span class="co">#&gt; 3 Neuralnet1_model 80.01379 2024 Jul -149.61350</span></span></code></pre></div>
<div class="sourceCode" id="cb269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="neuralnet-2" class="section level3" number="9.1.21">
<h3>
<span class="header-section-number">9.1.21</span> Neuralnet 2<a class="anchor" aria-label="anchor" href="#neuralnet-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Neuralnet2_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/NNETAR.html">NNETAR</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">trend</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Neuralnet2_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Neuralnet2_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Neuralnet2_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Neuralnet2_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Neuralnet2_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Neuralnet2_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Neuralnet2_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Neuralnet2_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;             .model    Error     Date      .mean</span></span>
<span><span class="co">#&gt; 1 Neuralnet2_model 53.91726 2024 May   234.1566</span></span>
<span><span class="co">#&gt; 2 Neuralnet2_model 53.91726 2024 Jun -1894.7670</span></span>
<span><span class="co">#&gt; 3 Neuralnet2_model 53.91726 2024 Jul -4940.7453</span></span></code></pre></div>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="neuralnet-3" class="section level3" number="9.1.22">
<h3>
<span class="header-section-number">9.1.22</span> Neuralnet 3<a class="anchor" aria-label="anchor" href="#neuralnet-3"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Neuralnet3_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/NNETAR.html">NNETAR</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">season</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Neuralnet3_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Neuralnet3_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Neuralnet3_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Neuralnet3_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Neuralnet3_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Neuralnet3_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Neuralnet3_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Neuralnet3_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;             .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Neuralnet3_model 32.00607 2024 May 277.4085</span></span>
<span><span class="co">#&gt; 2 Neuralnet3_model 32.00607 2024 Jun 425.5440</span></span>
<span><span class="co">#&gt; 3 Neuralnet3_model 32.00607 2024 Jul 249.4818</span></span></code></pre></div>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="neuralnet-4" class="section level3" number="9.1.23">
<h3>
<span class="header-section-number">9.1.23</span> Neuralnet 4<a class="anchor" aria-label="anchor" href="#neuralnet-4"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Neuralnet3_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/NNETAR.html">NNETAR</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">season</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Neuralnet3_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Neuralnet3_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Neuralnet3_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Neuralnet3_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Neuralnet3_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Neuralnet3_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Neuralnet3_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Neuralnet3_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;             .model    Error     Date     .mean</span></span>
<span><span class="co">#&gt; 1 Neuralnet3_model 47.50821 2024 May 263.52302</span></span>
<span><span class="co">#&gt; 2 Neuralnet3_model 47.50821 2024 Jun 240.83646</span></span>
<span><span class="co">#&gt; 3 Neuralnet3_model 47.50821 2024 Jul -38.30823</span></span></code></pre></div>
<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="prophet-additive" class="section level3" number="9.1.24">
<h3>
<span class="header-section-number">9.1.24</span> Prophet Additive<a class="anchor" aria-label="anchor" href="#prophet-additive"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Prophet_Additive_model</span> <span class="op">&lt;-</span> <span class="fu">fable.prophet</span><span class="fu">::</span><span class="fu"><a href="https://pkg.mitchelloharawild.com/fable.prophet/reference/prophet.html">prophet</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">season</span><span class="op">(</span>period <span class="op">=</span> <span class="fl">12</span>, type <span class="op">=</span> <span class="st">"additive"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Prophet_Additive_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Prophet_Additive_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Prophet_Additive_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Prophet_Additive_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Prophet_Additive_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Prophet_Additive_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Prophet_Additive_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Prophet_Additive_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   .model   Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Prophet_Additive_model 98.6034 2024 May 2686.376</span></span>
<span><span class="co">#&gt; 2 Prophet_Additive_model 98.6034 2024 Jun 3176.369</span></span>
<span><span class="co">#&gt; 3 Prophet_Additive_model 98.6034 2024 Jul 1016.474</span></span></code></pre></div>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="prophet-multiplicative" class="section level3" number="9.1.25">
<h3>
<span class="header-section-number">9.1.25</span> Prophet Multiplicative<a class="anchor" aria-label="anchor" href="#prophet-multiplicative"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Prophet_Multiplicative_model</span> <span class="op">&lt;-</span> <span class="fu">fable.prophet</span><span class="fu">::</span><span class="fu"><a href="https://pkg.mitchelloharawild.com/fable.prophet/reference/prophet.html">prophet</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">season</span><span class="op">(</span>period <span class="op">=</span> <span class="fl">12</span>, type <span class="op">=</span> <span class="st">"multiplicative"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Prophet_Multiplicative_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Prophet_Multiplicative_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Prophet_Multiplicative_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Prophet_Multiplicative_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Prophet_Multiplicative_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Prophet_Multiplicative_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Prophet_Multiplicative_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Prophet_Multiplicative_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                         .model    Error     Date     .mean</span></span>
<span><span class="co">#&gt; 1 Prophet_Multiplicative_model 75.97023 2024 May -37.12521</span></span>
<span><span class="co">#&gt; 2 Prophet_Multiplicative_model 75.97023 2024 Jun -65.45028</span></span>
<span><span class="co">#&gt; 3 Prophet_Multiplicative_model 75.97023 2024 Jul -30.47203</span></span></code></pre></div>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="seasonal-naive" class="section level3" number="9.1.26">
<h3>
<span class="header-section-number">9.1.26</span> Seasonal Naive<a class="anchor" aria-label="anchor" href="#seasonal-naive"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">SNaive_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/RW.html">SNAIVE</a></span><span class="op">(</span><span class="va">Difference</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">SNaive_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">SNaive_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">SNaive_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">SNaive_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">SNaive_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">SNaive_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">SNaive_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">SNaive_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;         .model    Error     Date .mean</span></span>
<span><span class="co">#&gt; 1 SNaive_model 98.94106 2024 May   281</span></span>
<span><span class="co">#&gt; 2 SNaive_model 98.94106 2024 Jun   185</span></span>
<span><span class="co">#&gt; 3 SNaive_model 98.94106 2024 Jul   187</span></span></code></pre></div>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="stochastic" class="section level3" number="9.1.27">
<h3>
<span class="header-section-number">9.1.27</span> Stochastic<a class="anchor" aria-label="anchor" href="#stochastic"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/robjhyndman/fpp3package">fpp3</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up the function:</span></span>
<span><span class="va">forecasting</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time_series_data</span>, <span class="va">train_amount</span>, <span class="va">number</span>, <span class="va">time_interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q"</span>, <span class="st">"M"</span>, <span class="st">"W"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Determine if the data is quarterly, monthly or weekly from the input:</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"Q"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-quarter.html">yearquarter</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"M"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-month.html">yearmonth</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">time_interval</span> <span class="op">==</span> <span class="st">"W"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Date <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/year-week.html">yearweek</a></span><span class="op">(</span><span class="va">Label</span><span class="op">)</span>, Value <span class="op">=</span> <span class="va">Value</span>, Difference <span class="op">=</span> <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/difference.html">difference</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Date</span>, <span class="va">Value</span>, <span class="va">Difference</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">tsibble</span><span class="fu">::</span><span class="fu"><a href="https://tsibble.tidyverts.org/reference/as-tsibble.html">as_tsibble</a></span><span class="op">(</span>index <span class="op">=</span> <span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Split the data into train and test:</span></span>
<span>  <span class="va">time_series_train</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="va">time_series_test</span> <span class="op">&lt;-</span> <span class="va">time_series_data</span><span class="op">[</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">train_amount</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">time_series_data</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Create the model:</span></span>
<span>  <span class="va">Stochastic_model</span> <span class="op">&lt;-</span> <span class="fu">fable</span><span class="fu">::</span><span class="fu"><a href="https://fable.tidyverts.org/reference/ARIMA.html">ARIMA</a></span><span class="op">(</span><span class="va">Difference</span> <span class="op">~</span> <span class="fu">pdq</span><span class="op">(</span>d <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, stepwise <span class="op">=</span> <span class="cn">TRUE</span>, greedy <span class="op">=</span> <span class="cn">TRUE</span>, approximation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the error:</span></span>
<span>  <span class="va">Stochastic_test_error</span> <span class="op">&lt;-</span> <span class="va">time_series_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span><span class="va">Stochastic_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/accuracy.html">accuracy</a></span><span class="op">(</span><span class="va">time_series_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Calculate the forecast:</span></span>
<span>  <span class="va">Stochastic_predictions</span> <span class="op">&lt;-</span> <span class="va">time_series_test</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://fabletools.tidyverts.org/reference/model.html">model</a></span><span class="op">(</span></span>
<span>      <span class="va">Stochastic_model</span>,</span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">fabletools</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/forecast.html">forecast</a></span><span class="op">(</span>h <span class="op">=</span> <span class="va">number</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Report the predictions:</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    <span class="st">'Model'</span> <span class="op">=</span> <span class="va">Stochastic_predictions</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>    <span class="st">'Error'</span> <span class="op">=</span> <span class="va">Stochastic_test_error</span><span class="op">$</span><span class="va">RMSE</span>,</span>
<span>    <span class="st">'Date'</span> <span class="op">=</span> <span class="va">Stochastic_predictions</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>    <span class="st">'Value'</span> <span class="op">=</span> <span class="va">Stochastic_predictions</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Test the function:</span></span>
<span><span class="va">time_series_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/InfiniteCuriosity/forecasting_jobs/main/Total_Nonfarm.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Ensembles/man/forecasting.html">forecasting</a></span><span class="op">(</span>time_series_data <span class="op">=</span> <span class="va">time_series_data</span>, train_amount <span class="op">=</span> <span class="fl">0.60</span>, number <span class="op">=</span> <span class="fl">3</span>, time_interval <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></span>
<span><span class="co">#&gt;             .model    Error     Date    .mean</span></span>
<span><span class="co">#&gt; 1 Stochastic_model 42.98025 2024 May 239.7312</span></span>
<span><span class="co">#&gt; 2 Stochastic_model 42.98025 2024 Jun 256.0506</span></span>
<span><span class="co">#&gt; 3 Stochastic_model 42.98025 2024 Jul 241.0237</span></span></code></pre></div>
<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="advice-to-lebron-james-and-everyone-who-does-talent-analytics-logistic-ensembles.html"><span class="header-section-number">8</span> Advice to Lebron James (and everyone who does talent analytics): Logistic ensembles</a></div>
<div class="next"><a href="ensembles-of-26-forecasting-models.html"><span class="header-section-number">10</span> Ensembles of 26 Forecasting Models</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#how-to-make-27-individual-forecasting-models"><span class="header-section-number">9</span> How to Make 27 Individual Forecasting Models</a></li>
<li>
<a class="nav-link" href="#individual-time-series-models"><span class="header-section-number">9.1</span> 12 Individual Time Series Models</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#arima-1"><span class="header-section-number">9.1.1</span> Arima 1</a></li>
<li><a class="nav-link" href="#arima-2"><span class="header-section-number">9.1.2</span> Arima 2</a></li>
<li><a class="nav-link" href="#arima3"><span class="header-section-number">9.1.3</span> Arima3</a></li>
<li><a class="nav-link" href="#arima4"><span class="header-section-number">9.1.4</span> Arima4</a></li>
<li><a class="nav-link" href="#deterministic"><span class="header-section-number">9.1.5</span> Deterministic</a></li>
<li><a class="nav-link" href="#drift"><span class="header-section-number">9.1.6</span> Drift</a></li>
<li><a class="nav-link" href="#ets1"><span class="header-section-number">9.1.7</span> ETS1</a></li>
<li><a class="nav-link" href="#ets2"><span class="header-section-number">9.1.8</span> ETS2</a></li>
<li><a class="nav-link" href="#ets3"><span class="header-section-number">9.1.9</span> ETS3</a></li>
<li><a class="nav-link" href="#ets4"><span class="header-section-number">9.1.10</span> ETS4</a></li>
<li><a class="nav-link" href="#holt-winters-additive"><span class="header-section-number">9.1.11</span> Holt-Winters Additive</a></li>
<li><a class="nav-link" href="#holt-winters-damped"><span class="header-section-number">9.1.12</span> Holt-Winters Damped</a></li>
<li><a class="nav-link" href="#holt-winters-multiplicative"><span class="header-section-number">9.1.13</span> Holt-Winters Multiplicative</a></li>
<li><a class="nav-link" href="#linear-1"><span class="header-section-number">9.1.14</span> Linear 1</a></li>
<li><a class="nav-link" href="#linear-2"><span class="header-section-number">9.1.15</span> Linear 2</a></li>
<li><a class="nav-link" href="#linear-3"><span class="header-section-number">9.1.16</span> Linear 3</a></li>
<li><a class="nav-link" href="#linear-4"><span class="header-section-number">9.1.17</span> Linear 4</a></li>
<li><a class="nav-link" href="#mean"><span class="header-section-number">9.1.18</span> Mean</a></li>
<li><a class="nav-link" href="#naive"><span class="header-section-number">9.1.19</span> Naive</a></li>
<li><a class="nav-link" href="#neuralnet-1"><span class="header-section-number">9.1.20</span> Neuralnet 1</a></li>
<li><a class="nav-link" href="#neuralnet-2"><span class="header-section-number">9.1.21</span> Neuralnet 2</a></li>
<li><a class="nav-link" href="#neuralnet-3"><span class="header-section-number">9.1.22</span> Neuralnet 3</a></li>
<li><a class="nav-link" href="#neuralnet-4"><span class="header-section-number">9.1.23</span> Neuralnet 4</a></li>
<li><a class="nav-link" href="#prophet-additive"><span class="header-section-number">9.1.24</span> Prophet Additive</a></li>
<li><a class="nav-link" href="#prophet-multiplicative"><span class="header-section-number">9.1.25</span> Prophet Multiplicative</a></li>
<li><a class="nav-link" href="#seasonal-naive"><span class="header-section-number">9.1.26</span> Seasonal Naive</a></li>
<li><a class="nav-link" href="#stochastic"><span class="header-section-number">9.1.27</span> Stochastic</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/InfinteCuriosity/EnsemblesBook/blob/master/08-Individual_Forecasting_Models.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/InfinteCuriosity/EnsemblesBook/edit/master/08-Individual_Forecasting_Models.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Ensembles: From Beginner to Expert</strong>" was written by Russ Conte. It was last built on 2024-06-03.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
