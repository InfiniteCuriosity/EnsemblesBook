<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 4 Building the first actual ensemble | Ensembles: From Beginner to Expert</title>
<meta name="author" content="Russ Conte">
<meta name="description" content="Load the packages we will need (MASS, tree): library(MASS) # for the Boston Housing data set library(tree) # To make models using trees library(Metrics) # To calculate error rate (root mean...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Chapter 4 Building the first actual ensemble | Ensembles: From Beginner to Expert">
<meta property="og:type" content="book">
<meta property="og:description" content="Load the packages we will need (MASS, tree): library(MASS) # for the Boston Housing data set library(tree) # To make models using trees library(Metrics) # To calculate error rate (root mean...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 4 Building the first actual ensemble | Ensembles: From Beginner to Expert">
<meta name="twitter:description" content="Load the packages we will need (MASS, tree): library(MASS) # for the Boston Housing data set library(tree) # To make models using trees library(Metrics) # To calculate error rate (root mean...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Ensembles: From Beginner to Expert</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Welcome!</a></li>
<li><a class="" href="hello-bookdown.html"><span class="header-section-number">2</span> Hello bookdown</a></li>
<li><a class="" href="introduction-and-your-first-ensembles.html"><span class="header-section-number">3</span> Introduction and your first ensembles</a></li>
<li><a class="active" href="building-the-first-actual-ensemble.html"><span class="header-section-number">4</span> Building the first actual ensemble</a></li>
<li><a class="" href="first-the-linear-model-with-randomized-data.html"><span class="header-section-number">5</span> First the linear model with randomized data</a></li>
<li><a class="" href="lets-have-a-quick-look-at-the-linear-model-predictions.html"><span class="header-section-number">6</span> Let’s have a quick look at the linear model predictions:</a></li>
<li><a class="" href="lets-calculate-the-root-mean-squared-error-rate-of-the-predictions.html"><span class="header-section-number">7</span> Let’s calculate the root mean squared error rate of the predictions:</a></li>
<li><a class="" href="lets-use-tree-models.html"><span class="header-section-number">8</span> Let’s use tree models</a></li>
<li><a class="" href="lets-have-a-quick-look-at-the-tree-model-predictions.html"><span class="header-section-number">9</span> Let’s have a quick look at the tree model predictions:</a></li>
<li><a class="" href="lets-calculate-the-root-mean-squared-error-rate-of-the-predictions-1.html"><span class="header-section-number">10</span> Let’s calculate the root mean squared error rate of the predictions:</a></li>
<li><a class="" href="ensemble-linear-modeling.html"><span class="header-section-number">11</span> Ensemble linear modeling</a></li>
<li><a class="" href="predictions-for-the-ensemble-linear-model.html"><span class="header-section-number">12</span> Predictions for the ensemble linear model</a></li>
<li><a class="" href="root-mean-squared-error-for-the-ensemble-linear-model.html"><span class="header-section-number">13</span> Root mean squared error for the ensemble linear model</a></li>
<li><a class="" href="this-section-of-code-saves-the-trained-models-in-the-current-environment.html"><span class="header-section-number">14</span> This section of code saves the trained models in the current environment</a></li>
<li><a class="" href="parts.html"><span class="header-section-number">15</span> Parts</a></li>
<li><a class="" href="footnotes-and-citations.html"><span class="header-section-number">16</span> Footnotes and citations</a></li>
<li><a class="" href="blocks.html"><span class="header-section-number">17</span> Blocks</a></li>
<li><a class="" href="sharing-your-book.html"><span class="header-section-number">18</span> Sharing your book</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/rstudio/bookdown-demo">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="building-the-first-actual-ensemble" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Building the first actual ensemble<a class="anchor" aria-label="anchor" href="#building-the-first-actual-ensemble"><i class="fas fa-link"></i></a>
</h1>
<p>Load the packages we will need (MASS, tree):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span> <span class="co"># for the Boston Housing data set</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span> <span class="co"># To make models using trees</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mfrasco/Metrics">Metrics</a></span><span class="op">)</span> <span class="co"># To calculate error rate (root mean squared error)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching core tidyverse packages ──── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.5</span></span>
<span><span class="co">#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.1</span></span>
<span><span class="co">#&gt; ✔ ggplot2   3.5.1     ✔ tibble    3.2.1</span></span>
<span><span class="co">#&gt; ✔ lubridate 1.9.3     ✔ tidyr     1.3.1</span></span>
<span><span class="co">#&gt; ✔ purrr     1.0.2     </span></span>
<span><span class="co">#&gt; ── Conflicts ────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span><span class="co">#&gt; ✖ dplyr::select() masks MASS::select()</span></span>
<span><span class="co">#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span></code></pre></div>
<p>Load the Boston Housing data set, and split it into train (60%) and test
(40%) sections.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/MASS/man/Boston.html">Boston</a></span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">400</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fl">401</span><span class="op">:</span><span class="fl">505</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Let's have a quick look at the tran and test sets</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="co">#&gt;      crim zn indus chas   nox    rm  age    dis rad tax</span></span>
<span><span class="co">#&gt; 1 0.00632 18  2.31    0 0.538 6.575 65.2 4.0900   1 296</span></span>
<span><span class="co">#&gt; 2 0.02731  0  7.07    0 0.469 6.421 78.9 4.9671   2 242</span></span>
<span><span class="co">#&gt; 3 0.02729  0  7.07    0 0.469 7.185 61.1 4.9671   2 242</span></span>
<span><span class="co">#&gt; 4 0.03237  0  2.18    0 0.458 6.998 45.8 6.0622   3 222</span></span>
<span><span class="co">#&gt; 5 0.06905  0  2.18    0 0.458 7.147 54.2 6.0622   3 222</span></span>
<span><span class="co">#&gt; 6 0.02985  0  2.18    0 0.458 6.430 58.7 6.0622   3 222</span></span>
<span><span class="co">#&gt;   ptratio  black lstat medv</span></span>
<span><span class="co">#&gt; 1    15.3 396.90  4.98 24.0</span></span>
<span><span class="co">#&gt; 2    17.8 396.90  9.14 21.6</span></span>
<span><span class="co">#&gt; 3    17.8 392.83  4.03 34.7</span></span>
<span><span class="co">#&gt; 4    18.7 394.63  2.94 33.4</span></span>
<span><span class="co">#&gt; 5    18.7 396.90  5.33 36.2</span></span>
<span><span class="co">#&gt; 6    18.7 394.12  5.21 28.7</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">test</span><span class="op">)</span></span>
<span><span class="co">#&gt;         crim zn indus chas   nox    rm   age    dis rad tax</span></span>
<span><span class="co">#&gt; 401 25.04610  0  18.1    0 0.693 5.987 100.0 1.5888  24 666</span></span>
<span><span class="co">#&gt; 402 14.23620  0  18.1    0 0.693 6.343 100.0 1.5741  24 666</span></span>
<span><span class="co">#&gt; 403  9.59571  0  18.1    0 0.693 6.404 100.0 1.6390  24 666</span></span>
<span><span class="co">#&gt; 404 24.80170  0  18.1    0 0.693 5.349  96.0 1.7028  24 666</span></span>
<span><span class="co">#&gt; 405 41.52920  0  18.1    0 0.693 5.531  85.4 1.6074  24 666</span></span>
<span><span class="co">#&gt; 406 67.92080  0  18.1    0 0.693 5.683 100.0 1.4254  24 666</span></span>
<span><span class="co">#&gt;     ptratio  black lstat medv</span></span>
<span><span class="co">#&gt; 401    20.2 396.90 26.77  5.6</span></span>
<span><span class="co">#&gt; 402    20.2 396.90 20.32  7.2</span></span>
<span><span class="co">#&gt; 403    20.2 376.11 20.31 12.1</span></span>
<span><span class="co">#&gt; 404    20.2 396.90 19.77  8.3</span></span>
<span><span class="co">#&gt; 405    20.2 329.46 27.38  8.5</span></span>
<span><span class="co">#&gt; 406    20.2 384.97 22.98  5.0</span></span></code></pre></div>
<p>Create a linear model by fitting the linear model on the training data,
and make predictions on the Boston Housing test data. Measure the
accuracy of the predictions against the actual values.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Boston_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span> <span class="co"># Fit the model to the training data</span></span>
<span><span class="va">Boston_lm_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">Boston_lm</span>, newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's have a quick look at the model predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Boston_lm_predictions</span><span class="op">)</span></span>
<span><span class="co">#&gt;       401       402       403       404       405       406 </span></span>
<span><span class="co">#&gt; 12.618507 19.785728 20.919370 13.014507  6.946392  5.123039</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Boston_linear_RMSE</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">medv</span>, predicted <span class="op">=</span> <span class="va">Boston_lm_predictions</span><span class="op">)</span></span>
<span><span class="va">Boston_linear_RMSE</span></span>
<span><span class="co">#&gt; [1] 6.108005</span></span></code></pre></div>
<p>The error rate for the linear model is 6.108005. Let’s do the same using
the tree method.</p>
<p>Create a model using trees by fitting the tree model on the training
data, and making predictions on the Boston Housing test data. Measure
the accuracy of the predictions against the actual values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Boston_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tree/man/tree.html">tree</a></span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span> <span class="co"># Fit the model to the training data</span></span>
<span><span class="va">Boston_tree_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">Boston_tree</span>, newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's have a quick look at the predictions:</span></span>
<span><span class="va">Boston_tree_predictions</span></span>
<span><span class="co">#&gt;      401      402      403      404      405      406 </span></span>
<span><span class="co">#&gt; 13.30769 13.30769 13.30769 13.30769 13.30769 13.30769 </span></span>
<span><span class="co">#&gt;      407      408      409      410      411      412 </span></span>
<span><span class="co">#&gt; 13.30769 44.62000 13.30769 23.32857 44.62000 13.30769 </span></span>
<span><span class="co">#&gt;      413      414      415      416      417      418 </span></span>
<span><span class="co">#&gt; 13.30769 13.30769 13.30769 13.30769 13.30769 13.30769 </span></span>
<span><span class="co">#&gt;      419      420      421      422      423      424 </span></span>
<span><span class="co">#&gt; 13.30769 23.32857 13.30769 13.30769 21.84327 13.30769 </span></span>
<span><span class="co">#&gt;      425      426      427      428      429      430 </span></span>
<span><span class="co">#&gt; 13.30769 13.30769 13.30769 13.30769 13.30769 13.30769 </span></span>
<span><span class="co">#&gt;      431      432      433      434      435      436 </span></span>
<span><span class="co">#&gt; 13.30769 23.32857 21.84327 13.30769 13.30769 13.30769 </span></span>
<span><span class="co">#&gt;      437      438      439      440      441      442 </span></span>
<span><span class="co">#&gt; 13.30769 13.30769 13.30769 13.30769 13.30769 13.30769 </span></span>
<span><span class="co">#&gt;      443      444      445      446      447      448 </span></span>
<span><span class="co">#&gt; 13.30769 13.30769 13.30769 13.30769 13.30769 13.30769 </span></span>
<span><span class="co">#&gt;      449      450      451      452      453      454 </span></span>
<span><span class="co">#&gt; 13.30769 13.30769 13.30769 13.30769 13.30769 23.32857 </span></span>
<span><span class="co">#&gt;      455      456      457      458      459      460 </span></span>
<span><span class="co">#&gt; 13.30769 13.30769 13.30769 13.30769 13.30769 13.30769 </span></span>
<span><span class="co">#&gt;      461      462      463      464      465      466 </span></span>
<span><span class="co">#&gt; 13.30769 13.30769 21.84327 21.84327 21.84327 21.84327 </span></span>
<span><span class="co">#&gt;      467      468      469      470      471      472 </span></span>
<span><span class="co">#&gt; 13.30769 13.30769 13.30769 13.30769 13.30769 21.84327 </span></span>
<span><span class="co">#&gt;      473      474      475      476      477      478 </span></span>
<span><span class="co">#&gt; 21.84327 23.32857 13.30769 13.30769 13.30769 13.30769 </span></span>
<span><span class="co">#&gt;      479      480      481      482      483      484 </span></span>
<span><span class="co">#&gt; 13.30769 21.84327 21.84327 27.07105 33.24694 21.84327 </span></span>
<span><span class="co">#&gt;      485      486      487      488      489      490 </span></span>
<span><span class="co">#&gt; 21.84327 21.84327 13.30769 21.84327 18.94792 18.94792 </span></span>
<span><span class="co">#&gt;      491      492      493      494      495      496 </span></span>
<span><span class="co">#&gt; 18.94792 18.94792 21.84327 21.84327 21.84327 18.94792 </span></span>
<span><span class="co">#&gt;      497      498      499      500      501      502 </span></span>
<span><span class="co">#&gt; 18.94792 21.84327 21.84327 18.94792 21.84327 27.07105 </span></span>
<span><span class="co">#&gt;      503      504      505 </span></span>
<span><span class="co">#&gt; 21.84327 33.24694 27.07105</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Boston_tree_RMSE</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">medv</span>, predicted <span class="op">=</span> <span class="va">Boston_tree_predictions</span><span class="op">)</span></span>
<span><span class="va">Boston_tree_RMSE</span></span>
<span><span class="co">#&gt; [1] 5.478017</span></span></code></pre></div>
<p>The error rate for the tree model is lower (which is better). The error
rate for the tree model is 5.478017.</p>
<div id="were-ready-to-make-our-first-ensemble" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> We’re ready to make our first ensemble!!<a class="anchor" aria-label="anchor" href="#were-ready-to-make-our-first-ensemble"><i class="fas fa-link"></i></a>
</h2>
<p>Make a new data frame. This will be our ensemble of model predictions.
One column will be the linear predictions, and one will be the tree
predictions. We’ll make a third column, the true values.</p>
<p>Make a new column for the true values—these are the true values in the
Boston Housing test data set</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ensemble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">'linear'</span> <span class="op">=</span> <span class="va">Boston_lm_predictions</span>,</span>
<span>  <span class="st">'tree'</span> <span class="op">=</span> <span class="va">Boston_tree_predictions</span>,</span>
<span>  <span class="st">'y'</span> <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">medv</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's have a look at the ensemble:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ensemble</span><span class="op">)</span></span>
<span><span class="co">#&gt;        linear     tree    y</span></span>
<span><span class="co">#&gt; 401 12.618507 13.30769  5.6</span></span>
<span><span class="co">#&gt; 402 19.785728 13.30769  7.2</span></span>
<span><span class="co">#&gt; 403 20.919370 13.30769 12.1</span></span>
<span><span class="co">#&gt; 404 13.014507 13.30769  8.3</span></span>
<span><span class="co">#&gt; 405  6.946392 13.30769  8.5</span></span>
<span><span class="co">#&gt; 406  5.123039 13.30769  5.0</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">ensemble</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 105   3</span></span></code></pre></div>
<p>Once we have the new ensemble data set, it’s simply another data set. No
different in many ways from any other data set (except how it was made).</p>
<p>Break the ensemble data set into train (60%) and test (40%) sections.
There is nothing special about the 60/40 split here, you may use any
numbers you wish.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ensemble_train</span> <span class="op">&lt;-</span> <span class="va">ensemble</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span>, <span class="op">]</span></span>
<span><span class="va">ensemble_test</span> <span class="op">&lt;-</span> <span class="va">ensemble</span><span class="op">[</span><span class="fl">61</span><span class="op">:</span><span class="fl">105</span>, <span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ensemble_train</span><span class="op">)</span></span>
<span><span class="co">#&gt;        linear     tree    y</span></span>
<span><span class="co">#&gt; 401 12.618507 13.30769  5.6</span></span>
<span><span class="co">#&gt; 402 19.785728 13.30769  7.2</span></span>
<span><span class="co">#&gt; 403 20.919370 13.30769 12.1</span></span>
<span><span class="co">#&gt; 404 13.014507 13.30769  8.3</span></span>
<span><span class="co">#&gt; 405  6.946392 13.30769  8.5</span></span>
<span><span class="co">#&gt; 406  5.123039 13.30769  5.0</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ensemble_test</span><span class="op">)</span></span>
<span><span class="co">#&gt;       linear     tree    y</span></span>
<span><span class="co">#&gt; 461 23.88984 13.30769 16.4</span></span>
<span><span class="co">#&gt; 462 23.29129 13.30769 17.7</span></span>
<span><span class="co">#&gt; 463 22.54055 21.84327 19.5</span></span>
<span><span class="co">#&gt; 464 25.50940 21.84327 20.2</span></span>
<span><span class="co">#&gt; 465 22.71231 21.84327 21.4</span></span>
<span><span class="co">#&gt; 466 20.83810 21.84327 19.9</span></span></code></pre></div>
<p>Fit a linear model to the ensemble training data. Make predictions using
the testing data, and measure the accuracy of the predictions against
the test data. Notice how similar this is to our linear and tree models.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Fit the model to the training data</span></span>
<span><span class="va">ensemble_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ensemble_train</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make predictions using the model on the test data</span></span>
<span><span class="va">ensemble_lm_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">ensemble_lm</span>, newdata <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate error rate for the ensemble predictions</span></span>
<span><span class="va">ensemble_lm_rmse</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">$</span><span class="va">y</span>, predicted <span class="op">=</span> <span class="va">ensemble_lm_predictions</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Report the error rate for the ensemble</span></span>
<span><span class="va">ensemble_lm_rmse</span></span>
<span><span class="co">#&gt; [1] 4.826962</span></span></code></pre></div>
<p>Summarize the results.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">'Model'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Linear'</span>, <span class="st">'Tree'</span>, <span class="st">'Ensemble'</span><span class="op">)</span>,</span>
<span>  <span class="st">'Error'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Boston_linear_RMSE</span>, <span class="va">Boston_tree_RMSE</span>, <span class="va">ensemble_lm_rmse</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt;      Model    Error</span></span>
<span><span class="co">#&gt; 1   Linear 6.108005</span></span>
<span><span class="co">#&gt; 2     Tree 5.478017</span></span>
<span><span class="co">#&gt; 3 Ensemble 4.826962</span></span></code></pre></div>
<p>Clearly the ensemble had the lowest error rate of the three models. The
ensemble is easily the best of the three models because it has the
lowest error rate of all the models.</p>
<div id="try-it-yourself-make-an-ensemble-where-the-ensemble-is-made-using-trees-instead-of-linear-models." class="section level3" number="4.1.1">
<h3>
<span class="header-section-number">4.1.1</span> Try it yourself: Make an ensemble where the ensemble is made using trees instead of linear models.<a class="anchor" aria-label="anchor" href="#try-it-yourself-make-an-ensemble-where-the-ensemble-is-made-using-trees-instead-of-linear-models."><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Fit the model to the training data</span></span>
<span><span class="va">ensemble_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tree/man/tree.html">tree</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ensemble_train</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make predictions using the model on the test data</span></span>
<span><span class="va">ensemble_tree_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">ensemble_tree</span>, newdata <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's look at the predictions</span></span>
<span><span class="va">ensemble_tree_predict</span></span>
<span><span class="co">#&gt;       461       462       463       464       465       466 </span></span>
<span><span class="co">#&gt; 14.800000 14.800000 18.942857 18.942857 18.942857 18.942857 </span></span>
<span><span class="co">#&gt;       467       468       469       470       471       472 </span></span>
<span><span class="co">#&gt; 14.800000 11.350000 13.044444 11.350000 14.800000 18.942857 </span></span>
<span><span class="co">#&gt;       473       474       475       476       477       478 </span></span>
<span><span class="co">#&gt; 18.942857 18.942857 13.044444 13.044444 14.800000  9.788235 </span></span>
<span><span class="co">#&gt;       479       480       481       482       483       484 </span></span>
<span><span class="co">#&gt; 14.800000 18.942857 18.942857 18.942857 18.942857 18.942857 </span></span>
<span><span class="co">#&gt;       485       486       487       488       489       490 </span></span>
<span><span class="co">#&gt; 18.942857 18.942857 14.800000 18.942857  9.788235  9.788235 </span></span>
<span><span class="co">#&gt;       491       492       493       494       495       496 </span></span>
<span><span class="co">#&gt;  9.788235  9.788235  9.788235 11.350000 11.350000 13.044444 </span></span>
<span><span class="co">#&gt;       497       498       499       500       501       502 </span></span>
<span><span class="co">#&gt;  9.788235 13.044444 18.942857 13.044444 11.350000 18.942857 </span></span>
<span><span class="co">#&gt;       503       504       505 </span></span>
<span><span class="co">#&gt; 18.942857 18.942857 18.942857</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Calculate the error rate</span></span>
<span><span class="va">ensemble_tree_rmse</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">$</span><span class="va">y</span>, predicted <span class="op">=</span> <span class="va">ensemble_tree_predict</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ensemble_tree_rmse</span></span>
<span><span class="co">#&gt; [1] 5.322011</span></span></code></pre></div>
<p>How does this compare to our three other results? Let’s update the
results table</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="st">'Model'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Linear'</span>, <span class="st">'Tree'</span>, <span class="st">'Ensemble_Linear'</span>, <span class="st">'Ensemble_Tree'</span><span class="op">)</span>,</span>
<span>  <span class="st">'Error'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Boston_linear_RMSE</span>, <span class="va">Boston_tree_RMSE</span>, <span class="va">ensemble_lm_rmse</span>, <span class="va">ensemble_tree_rmse</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Error</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt;             Model    Error</span></span>
<span><span class="co">#&gt; 1 Ensemble_Linear 4.826962</span></span>
<span><span class="co">#&gt; 2   Ensemble_Tree 5.322011</span></span>
<span><span class="co">#&gt; 3            Tree 5.478017</span></span>
<span><span class="co">#&gt; 4          Linear 6.108005</span></span></code></pre></div>
</div>
<div id="both-of-the-ensemble-models-beat-both-of-the-individual-models-in-this-example" class="section level3" number="4.1.2">
<h3>
<span class="header-section-number">4.1.2</span> Both of the ensemble models beat both of the individual models in this example<a class="anchor" aria-label="anchor" href="#both-of-the-ensemble-models-beat-both-of-the-individual-models-in-this-example"><i class="fas fa-link"></i></a>
</h3>
</div>
</div>
<div id="principle-what-is-one-improvement-that-can-be-made-use-a-diverse-set-of-models-and-ensembles-to-get-the-best-possible-result" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Principle: What is one improvement that can be made? Use a diverse set of models and ensembles to get the best possible result<a class="anchor" aria-label="anchor" href="#principle-what-is-one-improvement-that-can-be-made-use-a-diverse-set-of-models-and-ensembles-to-get-the-best-possible-result"><i class="fas fa-link"></i></a>
</h2>
<p>As we shall see when we go through and learn how to build ensembles, the
numerical method we will use will build 27 individual models and 13
ensembles for a total of 40 results. When the goal is to get the best
possible results, a diverse set of models and ensembles, such as the 40
results for numerical data, will produce much better results than a
limited number of models and ensembles.</p>
<p>We will do the same principal when we are looking at classification
data, logistic, data, and time series forecasting data. We will use a
large number of individual models and ensembles with the goal of
achieving the best possible result.</p>
</div>
<div id="principle-randomizing-the-data-before-the-analysis-will-make-the-results-more-general-and-is-very-easy-to-do" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Principle: Randomizing the data before the analysis will make the results more general (and is very easy to do!)<a class="anchor" aria-label="anchor" href="#principle-randomizing-the-data-before-the-analysis-will-make-the-results-more-general-and-is-very-easy-to-do"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> <span class="co"># Randomize the rows before the analysis</span></span></code></pre></div>
</div>
<div id="try-it-yourself-repeat-the-previous-analysis-but-randomize-the-rows-before-the-analysis.-otherwise-keep-the-process-the-same.-share-your-results-on-social-media." class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Try it yourself: Repeat the previous analysis, but randomize the rows before the analysis. Otherwise keep the process the same. Share your results on social media.<a class="anchor" aria-label="anchor" href="#try-it-yourself-repeat-the-previous-analysis-but-randomize-the-rows-before-the-analysis.-otherwise-keep-the-process-the-same.-share-your-results-on-social-media."><i class="fas fa-link"></i></a>
</h2>
<p>We’ll follow the exact same steps, except for randomizing the rows
first.</p>
<p>• Randomize the rows</p>
<p>• Break the data into train and test sets</p>
<p>• Fit the model to the training set</p>
<p>• Make predictions and calculate error from the model on the test set</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> <span class="co"># Randomize the rows before the analysis</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">400</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fl">401</span><span class="op">:</span><span class="fl">505</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Fit the model to the training data</span></span>
<span><span class="va">Boston_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make predictions using the model on the test data</span></span>
<span><span class="va">Boston_lm_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">Boston_lm</span>, newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's have a quick look at the linear model predictions:</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Boston_lm_predictions</span><span class="op">)</span></span>
<span><span class="co">#&gt;      339      351      227      185      480       14 </span></span>
<span><span class="co">#&gt; 22.34543 20.21164 37.69363 22.71957 21.62864 19.33689</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Boston_linear_rmse</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">medv</span>, predicted <span class="op">=</span> <span class="va">Boston_lm_predictions</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Boston_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tree/man/tree.html">tree</a></span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">Boston_tree_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">Boston_tree</span>, newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span>
<span><span class="va">Boston_tree_rmse</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">medv</span>, predicted <span class="op">=</span> <span class="va">Boston_tree_predictions</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's have a quick look at the tree model predictions:</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Boston_tree_predictions</span><span class="op">)</span></span>
<span><span class="co">#&gt;      339      351      227      185      480       14 </span></span>
<span><span class="co">#&gt; 23.13333 23.13333 46.93500 20.70000 20.70000 23.13333</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ensemble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span> <span class="st">'linear'</span> <span class="op">=</span> <span class="va">Boston_lm_predictions</span>, <span class="st">'tree'</span> <span class="op">=</span> <span class="va">Boston_tree_predictions</span>, <span class="st">'y_ensemble'</span> <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">medv</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">ensemble</span> <span class="op">&lt;-</span> <span class="va">ensemble</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ensemble</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span> <span class="co"># Randomizes the rows of the ensemble</span></span>
<span></span>
<span><span class="va">ensemble_train</span> <span class="op">&lt;-</span> <span class="va">ensemble</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span>, <span class="op">]</span></span>
<span><span class="va">ensemble_test</span> <span class="op">&lt;-</span> <span class="va">ensemble</span><span class="op">[</span><span class="fl">61</span><span class="op">:</span><span class="fl">105</span>, <span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ensemble_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y_ensemble</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ensemble_train</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predictions for the ensemble linear model</span></span>
<span></span>
<span><span class="va">ensemble_prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">ensemble_lm</span>, newdata <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Root mean squared error for the ensemble linear model</span></span>
<span></span>
<span><span class="va">ensemble_lm_rmse</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">$</span><span class="va">y_ensemble</span>, predicted <span class="op">=</span> <span class="va">ensemble_prediction</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Same for tree models</span></span>
<span></span>
<span><span class="va">ensemble_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tree/man/tree.html">tree</a></span><span class="op">(</span><span class="va">y_ensemble</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ensemble_train</span><span class="op">)</span></span>
<span><span class="va">ensemble_tree_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">ensemble_tree</span>, newdata <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">)</span></span>
<span><span class="va">ensemble_tree_rmse</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">$</span><span class="va">y_ensemble</span>, predicted <span class="op">=</span> <span class="va">ensemble_tree_predictions</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="st">'Linear'</span> <span class="op">=</span> <span class="va">Boston_linear_rmse</span>, <span class="st">'Trees'</span> <span class="op">=</span> <span class="va">Boston_tree_rmse</span>, <span class="st">'Ensembles_Linear'</span> <span class="op">=</span> <span class="va">ensemble_lm_rmse</span>, <span class="st">'Ensemble_Tree'</span> <span class="op">=</span> <span class="va">ensemble_tree_rmse</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt; $Linear</span></span>
<span><span class="co">#&gt; [1] 4.237618</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Trees</span></span>
<span><span class="co">#&gt; [1] 4.77213</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Ensembles_Linear</span></span>
<span><span class="co">#&gt; [1] 3.405902</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Ensemble_Tree</span></span>
<span><span class="co">#&gt; [1] 4.422181</span></span></code></pre></div>
<p>The fact that our results are a bit different from our first ensemble is
useful. This gives us another solid principle to use in our analysis
methods:</p>
</div>
<div id="the-more-we-can-randomize-the-data-the-more-our-results-will-match-nature" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> The more we can randomize the data, the more our results will match nature<a class="anchor" aria-label="anchor" href="#the-more-we-can-randomize-the-data-the-more-our-results-will-match-nature"><i class="fas fa-link"></i></a>
</h2>
<p>Just watch: Repeat the results 100 times, return the mean of the results
(hint: It’s two small changes)</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="co"># First the linear model with randomized data</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> <span class="co"># Randomize the rows before the analysis</span></span>
<span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">400</span>, <span class="op">]</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="fl">401</span><span class="op">:</span><span class="fl">505</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">Boston_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="va">Boston_lm_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">Boston_lm</span>, newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's have a quick look at the linear model predictions:</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Boston_lm_predictions</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's calculate the root mean squared error rate of the predictions:</span></span>
<span></span>
<span><span class="va">Boston_linear_rmse</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">medv</span>, predicted <span class="op">=</span> <span class="va">Boston_lm_predictions</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Boston_linear_rmse_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Boston_linear_rmse</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's use tree models</span></span>
<span></span>
<span><span class="va">Boston_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tree/man/tree.html">tree</a></span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Boston_tree_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">Boston_tree</span>, newdata <span class="op">=</span> <span class="va">test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's have a quick look at the tree model predictions:</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Boston_tree_predictions</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's calculate the root mean squared error rate of the predictions:</span></span>
<span></span>
<span><span class="va">Boston_tree_rmse</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">medv</span>, predicted <span class="op">=</span> <span class="va">Boston_tree_predictions</span><span class="op">)</span> </span>
<span><span class="va">Boston_tree_rmse_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Boston_tree_rmse</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ensemble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">'linear'</span> <span class="op">=</span> <span class="va">Boston_lm_predictions</span>, <span class="st">'tree'</span> <span class="op">=</span> <span class="va">Boston_tree_predictions</span>, <span class="st">'y_ensemble'</span> <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">medv</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">ensemble</span> <span class="op">&lt;-</span> <span class="va">ensemble</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">ensemble</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span> <span class="co"># Randomizes the rows of the ensemble</span></span>
<span></span>
<span><span class="va">ensemble_train</span> <span class="op">&lt;-</span> <span class="va">ensemble</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span>, <span class="op">]</span></span>
<span><span class="va">ensemble_test</span> <span class="op">&lt;-</span> <span class="va">ensemble</span><span class="op">[</span><span class="fl">61</span><span class="op">:</span><span class="fl">105</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Ensemble linear modeling</span></span>
<span></span>
<span><span class="va">ensemble_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y_ensemble</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ensemble_train</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Predictions for the ensemble linear model</span></span>
<span></span>
<span><span class="va">ensemble_prediction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">ensemble_lm</span>, newdata <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Root mean squared error for the ensemble linear model</span></span>
<span></span>
<span><span class="va">ensemble_lm_rmse</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">$</span><span class="va">y_ensemble</span>, predicted <span class="op">=</span> <span class="va">ensemble_prediction</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ensemble_lm_rmse_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ensemble_lm_rmse</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ensemble_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tree/man/tree.html">tree</a></span><span class="op">(</span><span class="va">y_ensemble</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ensemble_train</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ensemble_tree_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">ensemble_tree</span>, newdata <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">ensemble_tree_rmse</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">Metrics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Metrics/man/rmse.html">rmse</a></span><span class="op">(</span>actual <span class="op">=</span> <span class="va">ensemble_test</span><span class="op">$</span><span class="va">y_ensemble</span>, predicted <span class="op">=</span> </span>
<span><span class="va">ensemble_tree_predictions</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ensemble_tree_rmse_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ensemble_tree_rmse</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span> <span class="st">'Linear'</span> <span class="op">=</span> <span class="va">Boston_linear_rmse_mean</span>, <span class="st">'Trees'</span> <span class="op">=</span> <span class="va">Boston_tree_rmse_mean</span>, <span class="st">'Ensembles_Linear'</span> <span class="op">=</span> <span class="va">ensemble_lm_rmse_mean</span>, <span class="st">'Ensemble_Tree'</span> <span class="op">=</span> <span class="va">ensemble_tree_rmse_mean</span> <span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt; $Linear</span></span>
<span><span class="co">#&gt; [1] 4.854176</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Trees</span></span>
<span><span class="co">#&gt; [1] 4.694295</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Ensembles_Linear</span></span>
<span><span class="co">#&gt; [1] 4.196427</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $Ensemble_Tree</span></span>
<span><span class="co">#&gt; [1] 5.16779</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warnings.html">warnings</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># No warnings!</span></span></code></pre></div>
<div class="float">
<img src="_book/images/automate_as_much_as_possible.jpg" alt="Automate as much as possible"><div class="figcaption">Automate as much as
possible</div>
</div>
</div>
<div id="principle-is-this-my-very-best-work" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> Principle: “Is this my very best work?”<a class="anchor" aria-label="anchor" href="#principle-is-this-my-very-best-work"><i class="fas fa-link"></i></a>
</h2>
<p>This is your best work to build ensembles at this stage of your skills.
We are going to make a number of improvements to the solutions we see
here, so our final result will be much stronger than what we have here
so far. Always strive to do your very best work, without any excuses.</p>
</div>
<div id="where-do-i-get-help-with-errors-or-warnings" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> “Where do I get help with errors or warnings?”<a class="anchor" aria-label="anchor" href="#where-do-i-get-help-with-errors-or-warnings"><i class="fas fa-link"></i></a>
</h2>
<p>It is extremely useful to check if your code returns any errors or
warnings, and fix those as fast as possible. There are numerous sites to
help address errors in your code:</p>
<p><a href="https://stackoverflow.com" class="uri">https://stackoverflow.com</a></p>
<p><a href="https://forum.posit.co" class="uri">https://forum.posit.co</a></p>
<p><a href="https://www.r-project.org/help.html" class="uri">https://www.r-project.org/help.html</a></p>
</div>
<div id="is-there-an-easy-way-to-save-all-trained-models" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> Is there an easy way to save all trained models?<a class="anchor" aria-label="anchor" href="#is-there-an-easy-way-to-save-all-trained-models"><i class="fas fa-link"></i></a>
</h2>
<p>Absolutely! We will simply add the code at the end of this section that
saves the four trained models (linear, tree, ensemble_linear and
ensemble_tree), as follows:</p>
<p>{r save the trained models}</p>
<p>library(MASS) library(Metrics) library(tree)</p>
<p>ensemble_lm_rmse &lt;- 0 ensemble_tree_rmse &lt;- 0</p>
<p>for (i in 1:100) {</p>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="introduction-and-your-first-ensembles.html"><span class="header-section-number">3</span> Introduction and your first ensembles</a></div>
<div class="next"><a href="first-the-linear-model-with-randomized-data.html"><span class="header-section-number">5</span> First the linear model with randomized data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#building-the-first-actual-ensemble"><span class="header-section-number">4</span> Building the first actual ensemble</a></li>
<li>
<a class="nav-link" href="#were-ready-to-make-our-first-ensemble"><span class="header-section-number">4.1</span> We’re ready to make our first ensemble!!</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#try-it-yourself-make-an-ensemble-where-the-ensemble-is-made-using-trees-instead-of-linear-models."><span class="header-section-number">4.1.1</span> Try it yourself: Make an ensemble where the ensemble is made using trees instead of linear models.</a></li>
<li><a class="nav-link" href="#both-of-the-ensemble-models-beat-both-of-the-individual-models-in-this-example"><span class="header-section-number">4.1.2</span> Both of the ensemble models beat both of the individual models in this example</a></li>
</ul>
</li>
<li><a class="nav-link" href="#principle-what-is-one-improvement-that-can-be-made-use-a-diverse-set-of-models-and-ensembles-to-get-the-best-possible-result"><span class="header-section-number">4.2</span> Principle: What is one improvement that can be made? Use a diverse set of models and ensembles to get the best possible result</a></li>
<li><a class="nav-link" href="#principle-randomizing-the-data-before-the-analysis-will-make-the-results-more-general-and-is-very-easy-to-do"><span class="header-section-number">4.3</span> Principle: Randomizing the data before the analysis will make the results more general (and is very easy to do!)</a></li>
<li><a class="nav-link" href="#try-it-yourself-repeat-the-previous-analysis-but-randomize-the-rows-before-the-analysis.-otherwise-keep-the-process-the-same.-share-your-results-on-social-media."><span class="header-section-number">4.4</span> Try it yourself: Repeat the previous analysis, but randomize the rows before the analysis. Otherwise keep the process the same. Share your results on social media.</a></li>
<li><a class="nav-link" href="#the-more-we-can-randomize-the-data-the-more-our-results-will-match-nature"><span class="header-section-number">4.5</span> The more we can randomize the data, the more our results will match nature</a></li>
<li><a class="nav-link" href="#principle-is-this-my-very-best-work"><span class="header-section-number">4.6</span> Principle: “Is this my very best work?”</a></li>
<li><a class="nav-link" href="#where-do-i-get-help-with-errors-or-warnings"><span class="header-section-number">4.7</span> “Where do I get help with errors or warnings?”</a></li>
<li><a class="nav-link" href="#is-there-an-easy-way-to-save-all-trained-models"><span class="header-section-number">4.8</span> Is there an easy way to save all trained models?</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/rstudio/bookdown-demo/blob/master/02-Your_First_Ensembles.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/rstudio/bookdown-demo/edit/master/02-Your_First_Ensembles.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Ensembles: From Beginner to Expert</strong>" was written by Russ Conte. It was last built on 2024-05-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
